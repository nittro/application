!function(){function a(a){global.setImmediate?setImmediate(a):global.importScripts?setTimeout(a):(c++,d[c]=a,global.postMessage(c,"*"))}function b(c){"use strict";function d(a,b,c,d){if(2==i)return d();if("object"!=typeof j&&"function"!=typeof j||"function"!=typeof a)d();else try{var e=0;a.call(j,function(a){e++||(j=a,b())},function(a){e++||(j=a,c())})}catch(f){j=f,c()}}function e(){var a;try{a=j&&j.then}catch(b){return j=b,i=2,e()}d(a,function(){i=1,e()},function(){i=2,e()},function(){try{1==i&&"function"==typeof f?j=f(j):2==i&&"function"==typeof g&&(j=g(j),i=1)}catch(b){return j=b,l()}j==h?(j=TypeError(),l()):d(a,function(){l(3)},l,function(){l(1==i&&3)})})}if("function"!=typeof c&&void 0!=c)throw TypeError();if("object"!=typeof this||this&&this.then)throw TypeError();var f,g,h=this,i=0,j=0,k=[];h.promise=h,h.resolve=function(b){return f=h.fn,g=h.er,i||(j=b,i=1,a(e)),h},h.reject=function(b){return f=h.fn,g=h.er,i||(j=b,i=2,a(e)),h},h._d=1,h.then=function(a,c){if(1!=this._d)throw TypeError();var d=new b;return d.fn=a,d.er=c,3==i?d.resolve(j):4==i?d.reject(j):k.push(d),d},h["catch"]=function(a){return h.then(null,a)};var l=function(a){i=a||4,k.map(function(a){3==i&&a.resolve(j)||a.reject(j)})};try{"function"==typeof c&&c(h.resolve,h.reject)}catch(m){h.reject(m)}return h}global=this;var c=1,d={},e=!1;global.setImmediate||global.addEventListener("message",function(b){if(b.source==global)if(e)a(d[b.data]);else{e=!0;try{d[b.data]()}catch(b){}delete d[b.data],e=!1}}),b.resolve=function(a){if(1!=this._d)throw TypeError();return a instanceof b?a:new b(function(b){b(a)})},b.reject=function(a){if(1!=this._d)throw TypeError();return new b(function(b,c){c(a)})},b.all=function(a){function c(b,e){if(e)return d.resolve(e);if(b)return d.reject(b);var f=a.reduce(function(a,b){return b&&b.then?a+1:a},0);0==f&&d.resolve(a),a.map(function(b,d){b&&b.then&&b.then(function(b){return a[d]=b,c(),b},c)})}if(1!=this._d)throw TypeError();if(!(a instanceof Array))return b.reject(TypeError());var d=new b;return c(),d},b.race=function(a){function c(b,e){if(e)return d.resolve(e);if(b)return d.reject(b);var f=a.reduce(function(a,b){return b&&b.then?a+1:a},0);0==f&&d.resolve(a),a.map(function(a,b){a&&a.then&&a.then(function(a){c(null,a)},c)})}if(1!=this._d)throw TypeError();if(!(a instanceof Array))return b.reject(TypeError());if(0==a.length)return new b;var d=new b;return c(),d},b._d=1,"undefined"!=typeof module?module.exports=b:global.Promise=global.Promise||b}(),function(global,factory){"function"==typeof define&&define.amd?define(function(){return factory(global)}):"object"==typeof module&&"object"==typeof module.exports?module.exports=factory(global):global.Nette=factory(global)}("undefined"!=typeof window?window:this,function(window){"use strict";var Nette={};return Nette.addEvent=function(element,on,callback){var original=element["on"+on];element["on"+on]=function(){return"function"==typeof original&&original.apply(element,arguments)===!1?!1:callback.apply(element,arguments)}},Nette.getValue=function(elem){var i;if(elem){if(elem.tagName){if("radio"===elem.type){var elements=elem.form.elements;for(i=0;i<elements.length;i++)if(elements[i].name===elem.name&&elements[i].checked)return elements[i].value;return null}if("file"===elem.type)return elem.files||elem.value;if("select"===elem.tagName.toLowerCase()){var index=elem.selectedIndex,options=elem.options,values=[];if("select-one"===elem.type)return 0>index?null:options[index].value;for(i=0;i<options.length;i++)options[i].selected&&values.push(options[i].value);return values}if(elem.name&&elem.name.match(/\[\]$/)){var elements=elem.form.elements[elem.name].tagName?[elem]:elem.form.elements[elem.name],values=[];for(i=0;i<elements.length;i++)("checkbox"!==elements[i].type||elements[i].checked)&&values.push(elements[i].value);return values}return"checkbox"===elem.type?elem.checked:"textarea"===elem.tagName.toLowerCase()?elem.value.replace("\r",""):elem.value.replace("\r","").replace(/^\s+|\s+$/g,"")}return elem[0]?Nette.getValue(elem[0]):null}return null},Nette.getEffectiveValue=function(elem){var val=Nette.getValue(elem);return elem.getAttribute&&val===elem.getAttribute("data-nette-empty-value")&&(val=""),val},Nette.validateControl=function(elem,rules,onlyCheck,value){elem=elem.tagName?elem:elem[0],rules=rules||Nette.parseJSON(elem.getAttribute("data-nette-rules")),value=void 0===value?{value:Nette.getEffectiveValue(elem)}:value;for(var id=0,len=rules.length;len>id;id++){var rule=rules[id],op=rule.op.match(/(~)?([^?]+)/),curElem=rule.control?elem.form.elements.namedItem(rule.control):elem;if(curElem){rule.neg=op[1],rule.op=op[2],rule.condition=!!rule.rules,curElem=curElem.tagName?curElem:curElem[0];var curValue=elem===curElem?value:{value:Nette.getEffectiveValue(curElem)},success=Nette.validateRule(curElem,rule.op,rule.arg,curValue);if(null!==success)if(rule.neg&&(success=!success),rule.condition&&success){if(!Nette.validateControl(elem,rule.rules,onlyCheck,value))return!1}else if(!rule.condition&&!success){if(Nette.isDisabled(curElem))continue;if(!onlyCheck){var arr=Nette.isArray(rule.arg)?rule.arg:[rule.arg],message=rule.msg.replace(/%(value|\d+)/g,function(foo,m){return Nette.getValue("value"===m?curElem:elem.form.elements.namedItem(arr[m].control))});Nette.addError(curElem,message)}return!1}}}return!0},Nette.validateForm=function(sender){var form=sender.form||sender,scope=!1;if(form["nette-submittedBy"]&&null!==form["nette-submittedBy"].getAttribute("formnovalidate")){var scopeArr=Nette.parseJSON(form["nette-submittedBy"].getAttribute("data-nette-validation-scope"));if(!scopeArr.length)return!0;scope=new RegExp("^("+scopeArr.join("-|")+"-)")}var i,elem,radios={};for(i=0;i<form.elements.length;i++)if(elem=form.elements[i],!elem.tagName||elem.tagName.toLowerCase()in{input:1,select:1,textarea:1,button:1}){if("radio"===elem.type){if(radios[elem.name])continue;radios[elem.name]=!0}if(!(scope&&!elem.name.replace(/]\[|\[|]|$/g,"-").match(scope)||Nette.isDisabled(elem)||Nette.validateControl(elem)))return!1}return!0},Nette.isDisabled=function(elem){if("radio"===elem.type){for(var i=0,elements=elem.form.elements;i<elements.length;i++)if(elements[i].name===elem.name&&!elements[i].disabled)return!1;return!0}return elem.disabled},Nette.addError=function(elem,message){message&&alert(message),elem.focus&&elem.focus()},Nette.expandRuleArgument=function(form,arg){return arg&&arg.control&&(arg=Nette.getEffectiveValue(form.elements.namedItem(arg.control))),arg},Nette.validateRule=function(elem,op,arg,value){value=void 0===value?{value:Nette.getEffectiveValue(elem)}:value,":"===op.charAt(0)&&(op=op.substr(1)),op=op.replace("::","_"),op=op.replace(/\\/g,"");for(var arr=Nette.isArray(arg)?arg.slice(0):[arg],i=0,len=arr.length;len>i;i++)arr[i]=Nette.expandRuleArgument(elem.form,arr[i]);return Nette.validators[op]?Nette.validators[op](elem,Nette.isArray(arg)?arr:arr[0],value.value,value):null},Nette.validators={filled:function(elem,arg,val){return""!==val&&val!==!1&&null!==val&&(!Nette.isArray(val)||!!val.length)&&(!window.FileList||!(val instanceof window.FileList)||val.length)},blank:function(elem,arg,val){return!Nette.validators.filled(elem,arg,val)},valid:function(elem,arg,val){return Nette.validateControl(elem,null,!0)},equal:function(elem,arg,val){function toString(val){return"number"==typeof val||"string"==typeof val?""+val:val===!0?"1":""}if(void 0===arg)return null;val=Nette.isArray(val)?val:[val],arg=Nette.isArray(arg)?arg:[arg];loop:for(var i1=0,len1=val.length;len1>i1;i1++){for(var i2=0,len2=arg.length;len2>i2;i2++)if(toString(val[i1])===toString(arg[i2]))continue loop;return!1}return!0},notEqual:function(elem,arg,val){return void 0===arg?null:!Nette.validators.equal(elem,arg,val)},minLength:function(elem,arg,val){return val.length>=arg},maxLength:function(elem,arg,val){return val.length<=arg},length:function(elem,arg,val){return arg=Nette.isArray(arg)?arg:[arg,arg],(null===arg[0]||val.length>=arg[0])&&(null===arg[1]||val.length<=arg[1])},email:function(elem,arg,val){return/^("([ !#-[\]-~]|\\[ -~])+"|[-a-z0-9!#$%&'*+\/=?^_`{|}~]+(\.[-a-z0-9!#$%&'*+\/=?^_`{|}~]+)*)@([0-9a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,61}[0-9a-z\u00C0-\u02FF\u0370-\u1EFF])?\.)+[a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,17}[a-z\u00C0-\u02FF\u0370-\u1EFF])?$/i.test(val)},url:function(elem,arg,val,value){return/^[a-z\d+.-]+:/.test(val)||(val="http://"+val),/^https?:\/\/((([-_0-9a-z\u00C0-\u02FF\u0370-\u1EFF]+\.)*[0-9a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,61}[0-9a-z\u00C0-\u02FF\u0370-\u1EFF])?\.)?[a-z\u00C0-\u02FF\u0370-\u1EFF]([-0-9a-z\u00C0-\u02FF\u0370-\u1EFF]{0,17}[a-z\u00C0-\u02FF\u0370-\u1EFF])?|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}|\[[0-9a-f:]{3,39}\])(:\d{1,5})?(\/\S*)?$/i.test(val)?(value.value=val,!0):!1},regexp:function(elem,arg,val){var parts="string"==typeof arg?arg.match(/^\/(.*)\/([imu]*)$/):!1;try{return parts&&new RegExp(parts[1],parts[2].replace("u","")).test(val)}catch(e){}},pattern:function(elem,arg,val){try{return"string"==typeof arg?new RegExp("^("+arg+")$").test(val):null}catch(e){}},integer:function(elem,arg,val){return/^-?[0-9]+$/.test(val)},"float":function(elem,arg,val,value){return val=val.replace(" ","").replace(",","."),/^-?[0-9]*[.,]?[0-9]+$/.test(val)?(value.value=val,!0):!1},min:function(elem,arg,val){return Nette.validators.range(elem,[arg,null],val)},max:function(elem,arg,val){return Nette.validators.range(elem,[null,arg],val)},range:function(elem,arg,val){return Nette.isArray(arg)?(null===arg[0]||parseFloat(val)>=arg[0])&&(null===arg[1]||parseFloat(val)<=arg[1]):null},submitted:function(elem,arg,val){return elem.form["nette-submittedBy"]===elem},fileSize:function(elem,arg,val){if(window.FileList)for(var i=0;i<val.length;i++)if(val[i].size>arg)return!1;return!0},image:function(elem,arg,val){if(window.FileList&&val instanceof window.FileList)for(var i=0;i<val.length;i++){var type=val[i].type;if(type&&"image/gif"!==type&&"image/png"!==type&&"image/jpeg"!==type)return!1}return!0}},Nette.toggleForm=function(form,elem){var i;for(Nette.toggles={},i=0;i<form.elements.length;i++)form.elements[i].tagName.toLowerCase()in{input:1,select:1,textarea:1,button:1}&&Nette.toggleControl(form.elements[i],null,null,!elem);for(i in Nette.toggles)Nette.toggle(i,Nette.toggles[i],elem)},Nette.toggleControl=function(elem,rules,success,firsttime,value){rules=rules||Nette.parseJSON(elem.getAttribute("data-nette-rules")),value=void 0===value?{value:Nette.getEffectiveValue(elem)}:value;for(var curSuccess,has=!1,handled=[],handler=function(){Nette.toggleForm(elem.form,elem)},id=0,len=rules.length;len>id;id++){var rule=rules[id],op=rule.op.match(/(~)?([^?]+)/),curElem=rule.control?elem.form.elements.namedItem(rule.control):elem;if(curElem){if(curSuccess=success,success!==!1){rule.neg=op[1],rule.op=op[2];var curValue=elem===curElem?value:{value:Nette.getEffectiveValue(curElem)};if(curSuccess=Nette.validateRule(curElem,rule.op,rule.arg,curValue),null===curSuccess)continue;rule.neg&&(curSuccess=!curSuccess),rule.rules||(success=curSuccess)}if(rule.rules&&Nette.toggleControl(elem,rule.rules,curSuccess,firsttime,value)||rule.toggle){if(has=!0,firsttime)for(var oldIE=!document.addEventListener,name=curElem.tagName?curElem.name:curElem[0].name,els=curElem.tagName?curElem.form.elements:curElem,i=0;i<els.length;i++)els[i].name!==name||Nette.inArray(handled,els[i])||(Nette.addEvent(els[i],oldIE&&els[i].type in{checkbox:1,radio:1}?"click":"change",handler),handled.push(els[i]));for(var id2 in rule.toggle||[])Object.prototype.hasOwnProperty.call(rule.toggle,id2)&&(Nette.toggles[id2]=Nette.toggles[id2]||(rule.toggle[id2]?curSuccess:!curSuccess))}}}return has},Nette.parseJSON=function(s){return s=s||"[]","{op"===s.substr(0,3)?eval("["+s+"]"):window.JSON&&window.JSON.parse?JSON.parse(s):eval(s)},Nette.toggle=function(id,visible,srcElement){var elem=document.getElementById(id);elem&&(elem.style.display=visible?"":"none")},Nette.initForm=function(form){form.noValidate="novalidate",Nette.addEvent(form,"submit",function(e){return Nette.validateForm(form)?void 0:(e&&e.stopPropagation?e.stopPropagation():window.event&&(event.cancelBubble=!0),!1)}),Nette.addEvent(form,"click",function(e){e=e||event;var target=e.target||e.srcElement;form["nette-submittedBy"]=target.type in{submit:1,image:1}?target:null}),Nette.toggleForm(form)},Nette.initOnLoad=function(){Nette.addEvent(window,"load",function(){for(var i=0;i<document.forms.length;i++)for(var form=document.forms[i],j=0;j<form.elements.length;j++)if(form.elements[j].getAttribute("data-nette-rules")){Nette.initForm(form);break}})},Nette.isArray=function(arg){return"[object Array]"===Object.prototype.toString.call(arg)},Nette.inArray=function(arr,val){if([].indexOf)return arr.indexOf(val)>-1;for(var i=0;i<arr.length;i++)if(arr[i]===val)return!0;return!1},Nette.webalize=function(s){s=s.toLowerCase();var i,ch,res="";for(i=0;i<s.length;i++)ch=Nette.webalizeTable[s.charAt(i)],res+=ch?ch:s.charAt(i);return res.replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")},Nette.webalizeTable={"á":"a","ä":"a","č":"c","ď":"d","é":"e","ě":"e","í":"i","ľ":"l","ň":"n","ó":"o","ô":"o","ř":"r","š":"s","ť":"t","ú":"u","ů":"u","ý":"y","ž":"z"},Nette});var _context=function(){var api,undefined,t={},loaded=[],loading={},indexOf=Array.prototype.indexOf,REQ_TIMEOUT=3e4,doc=document,loc=doc.location,elem=function(n){return doc.createElement(n)},win=window,setTimeout=function(c,t){return win.setTimeout(c,t)},clearTimeout=function(t){return win.clearTimeout(t)},promise=Promise;"function"!=typeof indexOf&&(indexOf=function(e){for(var i=0;i<this.length;i++)if(this[i]===e)return i;return-1});var resolver=null,resolveUrl=function(u){return resolver||(resolver=elem("a")),resolver.href=u,resolver.href},isRelative=function(u){try{var len=/^https?:\/\/.+?(\/|$)/i.exec(loc.href)[0].length;return u.substr(0,len)===loc.href.substr(0,len)}catch(err){return!1}},xhrFactory=function(o,f){for(;o.length;)try{return f=o.shift(),f(),f}catch(e){}return function(){throw new Error}}([function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}]),xdrFactory=function(){try{if("withCredentials"in new XMLHttpRequest)return function(){return new XMLHttpRequest};if(win.XDomainRequest!==undefined)return function(){return new win.XDomainRequest}}catch(err){}return function(){throw new Error}}(),xhr=function(u){return new promise(function(fulfill,reject){var req,m;req=isRelative(u)?xhrFactory():xdrFactory(),req.open("GET",u,!0);var f=function(){m&&clearTimeout(m),fulfill(req)},r=function(){m&&clearTimeout(m),reject(req)};"onsuccess"in req?(req.onsuccess=f,req.onerror=r):win.XDomainRequest!==undefined&&req instanceof win.XDomainRequest?(req.onload=f,req.onerror=r):req.onreadystatechange=function(){4===req.readyState&&(200===req.status?f():r())},req.send(),m=setTimeout(function(){if(req.readyState&&req.readyState<4)try{req.abort()}catch(err){}m=null,r()},REQ_TIMEOUT)})},exec=function(s,t,u){var e;t=t?t.replace(/\s*;.*$/,"").toLowerCase():u.match(/\.(?:less|css)/i)?"text/css":"text/javascript","text/css"===t?(e=elem("style"),e.type=t,u=u.replace(/[^\/]+$/,""),s=s.replace(/url\s*\(('|")?(?:\.\/)?(.+?)\1\)/,function(m,q,n){return q||(q='"'),n.match(/^(?:(?:https?:)?\/)?\//)?"url("+q+n+q+")":"url("+q+resolveUrl(u+n)+q+")"}),e.styleSheet?e.styleSheet.cssText=s:e.appendChild(doc.createTextNode(s)),doc.head.appendChild(e)):(e=elem("script"),e.type="text/javascript",e.text=s,doc.head.appendChild(e).parentNode.removeChild(e))},map={names:[],classes:[]},lookup=function(s,c){var i=map.names.indexOf(s);if(i>-1)return map.classes[i];for(var n,r=t,p=s.split(".");p.length;){if(n=p.shift(),r[n]===undefined){if(!c)throw new Error(s+" not found in context");r[n]={}}r=r[n]}return map.names.push(s),map.classes.push(r),r},lookupClass=function(o){if("object"==typeof o&&o.constructor!==Object&&(o=o.constructor),"function"!=typeof o&&"object"!=typeof o)throw new Error("Cannot lookup class name of non-object");var i=map.classes.indexOf(o);return-1===i?!1:map.names[i]},load=function(){var u,a,p=promise.resolve(!0);for(a=0;a<arguments.length;a++)"function"==typeof arguments[a]?p=p.then(function(f){return function(){return invoke(f)}}(arguments[a])):"string"==typeof arguments[a]&&(u=resolveUrl(arguments[a]),-1===indexOf.call(loaded,u)&&(p=loading[u]?p.then(function(p){return function(){return p}}(loading[u])):loading[u]=function(p,u){return new promise(function(f,r){xhr(u).then(function(xhr){p.then(function(){exec(xhr.responseText,xhr.getResponseHeader("Content-Type"),u),delete loading[u],loaded.push(u),f()},r)})})}(p,u)));return a={then:function(fulfilled,rejected){return p.then(function(){fulfilled&&invoke(fulfilled)},function(){rejected&&invoke(rejected)}),a}}},nsStack=[],invoke=function(ns,f,i){i===undefined&&"function"==typeof ns&&(i=f,f=ns,ns=null),ns?nsStack.unshift(ns,ns=lookup(ns,!0)):(ns=t,nsStack.unshift(null,ns));var p,c,r,params=f.length?f.toString().match(/^function\s*\((.*?)\)/i)[1].split(/\s*,\s*/):[],args=[];for(p=0;p<params.length;p++)if("context"===params[p])args.push(api);else if("_NS_"===params[p])args.push(ns);else if("undefined"===params[p])args.push(undefined);else if(i!==undefined&&params[p]in i)c=i[params[p]],"string"==typeof c&&(c=lookup(c)),args.push(c);else if(ns[params[p]]!==undefined)args.push(ns[params[p]]);else{if(t[params[p]]===undefined)throw new Error('"'+params[p]+'" not found in context');args.push(t[params[p]])}return r=f.apply(ns,args),nsStack.shift(),nsStack.shift(),r},register=function(constructor,name){var ns=name.split(/\./g),key=ns.pop();return ns.length?ns=lookup(ns.join("."),!0):nsStack.length&&null!==nsStack[0]?(name=nsStack[0]+"."+name,ns=nsStack[1]):ns=t,ns[key]=constructor,map.names.push(name),map.classes.push(constructor),api},__ns=function(){arguments.length?nsStack.unshift(arguments[0],arguments[1]):(nsStack.shift(),nsStack.shift())},extend=function(parent,constructor,proto){proto||(proto=constructor,constructor=parent,parent=null),parent?"string"==typeof parent&&(parent=lookup(parent)):parent=Object;var tmp=function(){};return tmp.prototype=parent.prototype,constructor.prototype=new tmp,constructor.prototype.constructor=constructor,constructor.Super=parent,proto&&(proto.hasOwnProperty("STATIC")&&proto.STATIC&&copyProps(constructor,proto.STATIC),copyProps(constructor.prototype,proto)),constructor},mixin=function(target,source,map){return"string"==typeof source&&(source=lookup(source)),copyProps(target.prototype,source,map),target},copyProps=function(target,source,map){var key;for(key in source)source.hasOwnProperty(key)&&"STATIC"!==key&&(target[map&&key in map?map[key]:key]=source[key])};return api={lookup:lookup,lookupClass:lookupClass,invoke:invoke,load:load,extend:extend,mixin:mixin,register:register,__ns:__ns}}();_context.invoke("Utils",function(undefined){var Strings={applyModifiers:function(s){for(var a,m,f=Array.prototype.slice.call(arguments,1),i=0;i<f.length;i++)a=f[i].split(":"),m=a.shift(),a.unshift(s),s=Strings[m].apply(Strings,a);return s},toString:function(s){return s===undefined?"undefined":"string"==typeof s?s:s.toString!==undefined?s.toString():Object.prototype.toString.call(s)},sprintf:function(s){return Strings.vsprintf(s,Array.prototype.slice.call(arguments,1))},vsprintf:function(s,args){var n=0;return s.replace(/%(?:(\d+)\$)?(\.\d+|\[.*?:.*?\])?([idsfa%])/g,function(m,a,p,f){if("%"===f)return f;if(a=a?parseInt(a)-1:n++,args[a]===undefined)throw new Error("Missing parameter #"+(a+1));switch(a=args[a],f){case"s":return Strings.toString(a);case"i":case"d":return parseInt(a);case"f":return a=parseFloat(a),p&&p.match(/^\.\d+$/)&&(a=a.toFixed(parseInt(p.substr(1)))),a;case"a":return p=p&&p.match(/^\[.*:.*\]$/)?p.substr(1,p.length-2).split(":"):[", ",", "],0===a.length?"":a.slice(0,-1).join(p[0])+(a.length>1?p[1]:"")+a[a.length-1]}return m})},webalize:function(s,chars,ws){return ws&&(s=s.replace(/\s+/g,"_")),s=s.replace(new RegExp("[^_A-Za-zÀ-ſ"+Strings.escapeRegex(chars||"").replace(/\\-/g,"-")+"]+","g"),"-"),Strings.trim(s,"_-")},escapeRegex:function(s){return s.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},split:function(s,re,offsetCapture,noEmpty,delimCapture){re=re instanceof RegExp?new RegExp(re.source,[re.ignoreCase?"i":"",re.multiline?"m":"","g"].filter(function(v){return!!v}).join("")):new RegExp(re,"g");var r=[],len=0;return s=s.replace(re,function(m,p,ofs){return ofs=arguments[arguments.length-2],p=s.substring(len,ofs),(p.length&&!p.match(/^[\t ]+$/)||!noEmpty)&&r.push(offsetCapture?[p,len]:s.substring(len,ofs)),delimCapture&&(m.length&&!m.match(/^[\t ]+$/)||!noEmpty)&&r.push(offsetCapture?[m,ofs]:m),len=ofs+m.length,m}),(len<s.length||!noEmpty)&&(s=s.substring(len),(!noEmpty||s.length&&!s.match(/^[\t ]+$/))&&r.push(offsetCapture?[s,len]:s)),r},trim:function(s,c){return Strings._trim(s,c,!0,!0)},trimLeft:function(s,c){return Strings._trim(s,c,!0,!1)},trimRight:function(s,c){return Strings._trim(s,c,!1,!0)},_trim:function(s,c,l,r){c||(c=" 	\n\r\x00\x0BÂ ");var re=[];return c="["+Strings.escapeRegex(c)+"]+",l&&re.push("^",c),l&&r&&re.push("|"),r&&re.push(c,"$"),s.replace(new RegExp(re.join(""),"ig"),"")},firstUpper:function(s){return s.substr(0,1).toUpperCase()+s.substr(1)},compare:function(a,b,len){return"string"!=typeof a||"string"!=typeof b?!1:(len||(len=Math.min(a.length,b.length)),a.substr(0,len).toLowerCase()===b.substr(0,len).toLowerCase())},contains:function(h,n){return-1!==h.indexOf(n)},isNumeric:function(s){return"[object Array]"!==Object.prototype.toString.call(s)&&s-parseFloat(s)+1>=0},escapeHtml:function(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},nl2br:function(s,collapse){return s.replace(collapse?/\n+/g:/\n/g,"<br />")},random:function(len,chars){chars=(chars||"a-z0-9").replace(/.-./g,function(m,a,b){a=m.charCodeAt(0),b=m.charCodeAt(2);for(var n=Math.abs(b-a),c=new Array(n),o=Math.min(a,b),i=0;n>=i;i++)c[i]=o+i;return String.fromCharCode.apply(null,c)}),len||(len=8);var i,s=new Array(len),n=chars.length-1;for(i=0;len>i;i++)s[i]=chars[Math.round(Math.random()*n)];return s.join("")}};_context.register(Strings,"Strings")}),_context.invoke("Utils",function(undefined){var Arrays={isArray:function(a){return a&&a.constructor===Array},isArrayLike:function(a){return"object"==typeof a&&a.length!==undefined},shuffle:function(a){for(var t,i,c=a.length;c--;)i=Math.random()*c|0,t=a[c],a[c]=a[i],a[i]=t;return a},createFrom:function(a,s,e){if(a.length===undefined)throw new Error("Invalid argument, only array-like objects can be supplied");return Array.prototype.slice.call(a,s||0,e||a.length)},getKeys:function(a){var k,keys=[];if(Arrays.isArray(a))for(k=0;k<a.length;k++)keys.push(k);else for(k in a)keys.push(k);return keys},filterKeys:function(){var a,i,rem,args=Arrays.createFrom(arguments),t=args.shift(),r={};for(rem=function(k){r[k]===undefined&&(r[k]=t[k],delete t[k])};args.length;)if(a=args.shift(),"object"==typeof a)if(a instanceof Array)for(i=0;i<a.length;i++)rem(a[i]);else for(i in a)rem(i);else rem(a)},getValues:function(a){var k,arr=[];for(k in a)arr.push(a[k]);return arr},merge:function(){var b,i,args=Arrays.createFrom(arguments),a=args.shift(),r=!1;for("boolean"==typeof a&&(r=a,a=args.shift()),a||(a=[]);args.length;)if(b=args.shift(),b instanceof Array)for(i=0;i<b.length;i++)r&&"object"==typeof b[i]&&"[object Object]"===Object.prototype.toString.call(b[i])?a.push(Arrays.mergeTree(r,{},b[i])):a.push(b[i]);return a},mergeTree:function(){var r=!1,args=Arrays.createFrom(arguments),ofs=1,t=args.shift(),props=[];for("boolean"==typeof t&&(r=t,t=args.shift(),ofs=2);args.length;){var p,a,i,o=args.pop();if("object"==typeof o&&null!==o){t||(t={});for(p in o)if(o.hasOwnProperty(p)&&-1===props.indexOf(p)){if("object"==typeof o[p])if(r)if(o[p]instanceof Array){for(a=[r,t[p]||null],i=ofs;i<arguments.length;i++)a.push(arguments[i][p]||null);t[p]=Arrays.merge.apply(this,a)}else{for(a=[r,null],i=ofs;i<arguments.length;i++)a.push(arguments[i]?arguments[i][p]||null:null);t[p]=Arrays.mergeTree.apply(this,a)||t[p]}else t[p]=t[p]===undefined?o[p]:null===o[p]?t[p]:o[p];else t[p]=o[p];props.push(p)}}}return t},walk:function(r,a,f){"boolean"!=typeof r&&(f=a,a=r,r=!1);var i,p=function(k,v){r&&(v instanceof Array||v instanceof Object)?Arrays.walk(r,v,f):f.call(v,k,v)};if(a instanceof Array)for(i=0;i<a.length;i++)p(i,a[i]);else if(a instanceof Object)for(i in a)p(i,a[i]);else p(null,a)}};_context.register(Arrays,"Arrays")}),_context.invoke("Utils",function(Arrays,undefined){var HashMap=_context.extend(function(src){this._={keys:[],values:[],nonNumeric:0,nextNumeric:0},src&&this.merge(src)},{STATIC:{from:function(data,keys){if(!keys)return data instanceof HashMap?data.clone():new HashMap(data);if(!Arrays.isArray(keys))throw new Error("Invalid argument supplied to HashMap.from(): the second argument must be an array");var i,k,map=new HashMap,n=keys.length,arr=Arrays.isArray(data);for(i=0;n>i;i++)k=arr?i:keys[i],data[k]!==undefined&&map.set(keys[i],data[k]);return map}},length:0,isList:function(){return 0===this._.nonNumeric},clone:function(deep){var o=new HashMap;return o._.keys=this._.keys.slice(),o._.nextNumeric=this._.nextNumeric,o.length=this.length,deep?o._.values=this._.values.map(function(v){return v instanceof HashMap?v.clone(deep):v}):o._.values=this._.values.slice(),o},merge:function(src){if(src instanceof HashMap||Arrays.isArray(src))src.forEach(function(value,key){this.set(key,value)},this);else{if("object"!=typeof src||null===src)throw new TypeError("HashMap.merge() expects the first argument to be an array or an object, "+typeof src+" given");for(var k in src)src.hasOwnProperty(k)&&this.set(k,src[k])}return this},append:function(src){return src instanceof HashMap||Arrays.isArray(src)?src.forEach(function(value,key){"number"==typeof key?this.push(value):this.set(key,value)},this):this.merge(src),this},push:function(value){for(var i=0;i<arguments.length;i++)this._.keys.push(this._.nextNumeric),this._.values.push(arguments[i]),this._.nextNumeric++,this.length++;return this},pop:function(){if(!this.length)return null;var k=this._.keys.pop();return"number"==typeof k?k+1===this._.nextNumeric&&this._.nextNumeric--:this._.nonNumeric--,this.length--,this._.values.pop()},shift:function(){return this.length?("number"==typeof this._.keys[0]?(this._.nextNumeric--,this._shiftKeys(1,this.length,-1)):this._.nonNumeric--,this.length--,this._.keys.shift(),this._.values.shift()):null},unshift:function(value){for(var values=Arrays.createFrom(arguments),n=values.length,i=0,keys=new Array(n);n>i;)keys[i]=i++;return keys.unshift(0,0),values.unshift(0,0),this._shiftKeys(0,this.length,n),this._.keys.splice.apply(this._.keys,keys),this._.values.splice.apply(this._.values,values),this._.nextNumeric+=n,this.length+=n,this},slice:function(from,to){from===undefined&&(from=0),0>from&&(from+=this.length),to===undefined&&(to=this.length),0>to&&(to+=this.length);var o=new HashMap;return o._.keys=this._.keys.slice(from,to).map(function(k){return"number"==typeof k?(k=o._.nextNumeric,o._.nextNumeric++,k):(o._.nonNumeric++,k)}),o._.values=this._.values.slice(from,to),o.length=o._.keys.length,o},splice:function(from,remove){var removed,i,values=Arrays.createFrom(arguments),keys=values.slice().map(function(){return-1});for(keys[0]=values[0],keys[1]=values[1],this._.keys.splice.apply(this._.keys,keys),removed=this._.values.splice.apply(this._.values,values),this.length=this._.keys.length,this._.nextNumeric=0,this._.nonNumeric=0,i=0;i<this.length;i++)"number"==typeof this._.keys[i]?(this._.keys[i]=this._.nextNumeric,this._.nextNumeric++):this._.nonNumeric++;return removed},set:function(key,value){var i=this._.keys.indexOf(key);return-1===i?(this._.keys.push(key),this._.values.push(value),this.length++,"number"==typeof key?key>=this._.nextNumeric&&(this._.nextNumeric=key+1):this._.nonNumeric++):this._.values[i]=value,this},get:function(key,need){var i=this._.keys.indexOf(key);if(i>-1)return this._.values[i];if(need)throw new RangeError("Key "+key+" not present in HashMap");return null},has:function(key){var index=this._.keys.indexOf(key);return index>-1&&this._.values[index]!==undefined},forEach:function(callback,thisArg){for(var i=0;i<this.length;i++)callback.call(thisArg||null,this._.values[i],this._.keys[i],this);return this},map:function(callback,recursive,thisArg){return this.clone(recursive).walk(callback,recursive,thisArg)},walk:function(callback,recursive,thisArg){for(var i=0;i<this.length;i++)recursive&&this._.values[i]instanceof HashMap?this._.values[i].walk(callback,recursive,thisArg):this._.values[i]=callback.call(thisArg||null,this._.values[i],this._.keys[i],this);return this},find:function(predicate,thisArg){var i=this._find(predicate,thisArg,!0);return i===!1?null:this._.values[i]},findKey:function(predicate,thisArg){var i=this._find(predicate,thisArg,!0);return i===!1?null:this._.keys[i]},some:function(predicate,thisArg){return this._find(predicate,thisArg,!0)!==!1},all:function(predicate,thisArg){return this._find(predicate,thisArg,!1)===!1},filter:function(predicate,thisArg){var i,o=new HashMap;for(i=0;i<this.length;i++)predicate.call(thisArg||null,this._.values[i],this._.keys[i],this)&&("number"==typeof this._.keys[i]?o.push(this._.values[i]):o.set(this._.keys[i],this._.values[i]));return o},exportData:function(){if(this.isList())return this.getValues().map(function(v){return v instanceof HashMap?v.exportData():v});for(var i=0,r={};i<this.length;i++)this._.values[i]instanceof HashMap?r[this._.keys[i]]=this._.values[i].exportData():r[this._.keys[i]]=this._.values[i];return r},getKeys:function(){return this._.keys.slice()},getValues:function(){return this._.values.slice()},_shiftKeys:function(from,to,diff){for(;to>from;)"number"==typeof this._.keys[from]&&(this._.keys[from]+=diff),from++},_find:function(predicate,thisArg,expect){for(var i=0;i<this.length;i++)if(predicate.call(thisArg||null,this._.values[i],this._.keys[i],this)===expect)return i;return!1}});_context.register(HashMap,"HashMap")}),_context.invoke("Utils",function(Strings,undefined){var Url=function(s){var cur=document.location.href.match(Url.PARSER_REGEXP),src=null===s||""===s||s===undefined?cur:s.match(Url.PARSER_REGEXP),noHost=!src[4],path=src[6]||"";noHost&&"/"!==path.charAt(0)&&(path=path.length?Url.getDirName(cur[6]||"")+"/"+path.replace(/^\.\//,""):cur[6]),this._={protocol:src[1]||cur[1]||"",username:(noHost?src[2]||cur[2]:src[2])||"",password:(noHost?src[3]||cur[3]:src[3])||"",hostname:src[4]||cur[4]||"",port:(noHost?src[5]||cur[5]:src[5])||"",path:path,params:Url.parseQuery((noHost&&!src[6]?src[7]||cur[7]:src[7])||""),hash:(!noHost||src[6]||src[7]?src[8]:src[8]||cur[8])||""}};Url.prototype.getProtocol=function(){return this._.protocol},Url.prototype.getUsername=function(){return this._.username},Url.prototype.getPassword=function(){return this._.password},Url.prototype.getHostname=function(){return this._.hostname},Url.prototype.getPort=function(){return this._.port},Url.prototype.getAuthority=function(){var a="";return this._.username&&(a+=this._.password?this._.username+":"+this._.password+"@":this._.username+"@"),a+=this._.hostname,this._.port&&(a+=":"+this._.port),a},Url.prototype.getPath=function(){return this._.path},Url.prototype.getQuery=function(){var q=Url.buildQuery(this._.params);return q.length?"?"+q:""},Url.prototype.getParam=function(n){return this._.params[n]},Url.prototype.hasParam=function(n){return this._.params[n]!==undefined},Url.prototype.getParams=function(){return this._.params},Url.prototype.getHash=function(){return this._.hash},Url.prototype.setProtocol=function(protocol){return this._.protocol=protocol?Strings.trimRight(protocol,":")+":":"",this},Url.prototype.setUsername=function(username){return this._.username=username,
this},Url.prototype.setPassword=function(password){return this._.password=password,this},Url.prototype.setHostname=function(hostname){return this._.hostname=hostname,this},Url.prototype.setPort=function(port){return this._.port=port,this},Url.prototype.setPath=function(path){return this._.path=path?"/"+Strings.trimLeft(path,"/"):"",this},Url.prototype.setQuery=function(query){return this._.params=Url.parseQuery(query),this},Url.prototype.setParam=function(n,v){return this._.params[n]=v,this},Url.prototype.addParams=function(p){if(p instanceof Array&&(p.length<1||"name"in p[0]))for(var i=0;i<p.length;i++)this._.params[p[i].name]=p[i].value;else for(var k in p)p[k]!==undefined&&(this._.params[k]=p[k]);return this},Url.prototype.getParams=function(){return this._.params},Url.prototype.setParams=function(p){return this._.params={},this.addParams(p),this},Url.prototype.removeParam=function(n){return delete this._.params[n],this},Url.prototype.setHash=function(hash){return this._.hash=hash?"#"+Strings.trimLeft(hash,"#"):"",this},Url.prototype.toAbsolute=function(){return this._.protocol+"//"+this.getAuthority()+this._.path+this.getQuery()+this._.hash},Url.prototype.toLocal=function(){return this._.path+this.getQuery()+this._.hash},Url.prototype.toRelative=function(to){if(to=Url.from(to||document.location.href),to.getProtocol()!==this.getProtocol())return this.toAbsolute();if(to.getAuthority()!==this.getAuthority())return"//"+this.getAuthority()+this.getPath()+this.getQuery()+this.getHash();if(to.getPath()!==this.getPath())return Url.getRelativePath(to.getPath(),this.getPath())+this.getQuery()+this.getHash();var qto=to.getQuery(),qthis=this.getQuery();return qto!==qthis?qthis+this.getHash():to.getHash()===this.getHash()?"":this.getHash()},Url.prototype.toString=function(){return this.toAbsolute()},Url.prototype.isLocal=function(){return this.compare(Url.fromCurrent())<=Url.PART.PORT},Url.prototype.compare=function(to){to instanceof Url||(to=Url.from(to));var r=0;return this.getProtocol()!==to.getProtocol()&&(r|=Url.PART.PROTOCOL),this.getUsername()!==to.getUsername()&&(r|=Url.PART.USERNAME),this.getPassword()!==to.getPassword()&&(r|=Url.PART.PASSWORD),this.getHostname()!==to.getHostname()&&(r|=Url.PART.HOSTNAME),this.getPort()!==to.getPort()&&(r|=Url.PART.PORT),this.getPath()!==to.getPath()&&(r|=Url.PART.PATH),this.getQuery()!==to.getQuery()&&(r|=Url.PART.QUERY),this.getHash()!==to.getHash()&&(r|=Url.PART.HASH),r},Url.PARSER_REGEXP=/^(?:([^:/]+:)?\/\/(?:([^\/@]+?)(?::([^\/@]+))?@)?(?:([^/]+?)(?::(\d+))?(?=\/|$))?)?(.*?)(\?.*?)?(#.*)?$/,Url.PART={PROTOCOL:128,USERNAME:64,PASSWORD:32,HOSTNAME:16,PORT:8,PATH:4,QUERY:2,HASH:1},Url.from=function(s){return new Url(s instanceof Url?s.toAbsolute():"string"==typeof s||null===s||s===undefined?s:Strings.toString(s))},Url.fromCurrent=function(){return new Url},Url.getDirName=function(path){return path.replace(/(^|\/)[^\/]*$/,"")},Url.getRelativePath=function(from,to){if(from=Strings.trimLeft(from,"/").split("/"),from.pop(),!to.match(/^\//))return to.replace(/^\.\//,"");to=Strings.trimLeft(to,"/").split("/");for(var f,t,e=0,o=[],n=Math.min(from.length,to.length);n>e&&from[e]===to[e];e++);for(f=e;f<from.length;f++)o.push("..");for(t=e;t<to.length;t++)o.push(to[t]);return o.join("/")},Url.buildQuery=function(data,pairs){var n,q=[],en=encodeURIComponent,val=function(v){return v===undefined?null:"boolean"==typeof v?v?1:0:en(""+v)},flatten=function(a,n){var i,r=[];if(Array.isArray(a))for(i=0;i<a.length;i++)r.push(en(n+"[]")+"="+val(a[i]));else for(i in a)"object"==typeof a[i]?r.push(flatten(a[i],n+"["+i+"]")):r.push(en(n+"["+i+"]")+"="+val(a[i]));return r.filter(function(v){return null!==v}).join("&")};for(n in data)null!==data[n]&&data[n]!==undefined&&(pairs?q.push(en(data[n].name)+"="+val(data[n].value)):"object"==typeof data[n]?q.push(flatten(data[n],n)):q.push(en(n)+"="+val(data[n])));return q.filter(function(v){return null!==v}).join("&")},Url.parseQuery=function(s){if(s.match(/^\??$/))return{};s=Strings.trimLeft(s,"?").split("&");var c,d,k,i,m,n,v,p={},a=!1,convertType=function(v){return v.match(/^\d+$/)?parseInt(v):v.match(/^\d*\.\d+$/)?parseFloat(v):v};for(i=0;i<s.length;i++)if(m=s[i].split("="),n=decodeURIComponent(m.shift()),v=convertType(decodeURIComponent(m.join("="))),-1!==n.indexOf("[")){for(n=n.replace(/\]/g,""),d=n.split("["),c=p,a=!1,n.match(/\[$/)&&(d.pop(),a=!0),n=d.pop();d.length;)k=d.shift(),c[k]===undefined&&(c[k]={}),c=c[k];a?c[n]===undefined?c[n]=[v]:c[n].push(v):c[n]=v}else p[n]=v;return p},_context.register(Url,"Url")}),_context.invoke("Utils",function(Arrays,Strings,undefined){var map=function(args,callback){if(args=Arrays.createFrom(args),Arrays.isArray(args[0])){for(var i=0,elems=args[0],ret=[];i<elems.length;i++)args[0]=getElem(elems[i]),args[0]?ret.push(callback.apply(null,args)):ret.push(args[0]);return ret}return args[0]=getElem(args[0]),args[0]?callback.apply(null,args):args[0]},getElem=function(elem){return Arrays.isArray(elem)&&(elem=elem[0]),"string"==typeof elem?DOM.getById(elem):elem},getPrefixed=function(elem,prop){if(Arrays.isArray(elem)&&(elem=elem[0]),prop in elem.style)return prop;var i,p=prop.charAt(0).toUpperCase()+prop.substr(1),variants=["webkit"+p,"moz"+p,"o"+p,"ms"+p];for(i=0;i<variants.length;i++)if(variants[i]in elem.style)return variants[i];return prop},DOM={getByClassName:function(className){return Arrays.createFrom(document.getElementsByClassName(className))},getById:function(id){return document.getElementById(id)},getChildren:function(elem){return Arrays.createFrom(elem.childNodes).filter(function(node){return 1===node.nodeType})},closest:function(elem,nodeName,className){return map(arguments,function(elem,nodeName,className){for(;elem;){if(1===elem.nodeType&&(!nodeName||elem.nodeName.toLowerCase()===nodeName)&&(!className||DOM.hasClass(elem,className)))return elem;elem=elem.parentNode}return null})},create:function(elem,attrs){return elem=document.createElement(elem),attrs&&DOM.setAttributes(elem,attrs),elem},createFromHtml:function(html){var container=DOM.create("div");return DOM.html(container,html),html=DOM.getChildren(container),html.forEach(function(e){container.removeChild(e)}),container=null,html.length>1?html:html[0]},setAttributes:function(elem,attrs){return map([elem],function(elem){for(var a in attrs)attrs.hasOwnProperty(a)&&elem.setAttribute(a,attrs[a]);return elem})},setStyle:function(elem,prop,value,prefix){if(prop&&"object"==typeof prop){prefix=value,value=prop;for(prop in value)value.hasOwnProperty(prop)&&DOM.setStyle(elem,prop,value[prop],prefix);return elem}return prefix!==!1&&(prop=getPrefixed(elem,prop)),map([elem],function(elem){elem.style[prop]=value})},html:function(elem,html){return map([elem],function(elem){elem.innerHTML=html,Arrays.createFrom(elem.getElementsByTagName("script")).forEach(function(elem){if(!elem.type||"text/javascript"===elem.type.toLowerCase()){var load=elem.hasAttribute("src"),src=load?elem.src:elem.text||elem.textContent||elem.innerHTML||"",script=DOM.create("script",{type:"text/javascript"});if(load)script.src=src;else try{script.appendChild(document.createTextNode(src))}catch(e){script.text=src}elem.parentNode.insertBefore(script,elem),elem.parentNode.removeChild(elem)}})})},contains:null,addListener:null,removeListener:null,addClass:null,removeClass:null,toggleClass:null,hasClass:null,getData:null,setData:null},rnative=/^[^{]+\{\s*\[native \w/;if(rnative.test(document.documentElement.compareDocumentPosition)||rnative.test(document.documentElement.contains)?DOM.contains=function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:DOM.contains=function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},"addEventListener"in document)DOM.addListener=function(elem,evt,listener){return map(arguments,function(elem,evt,listener){return elem.addEventListener(evt,listener,!1),elem})},DOM.removeListener=function(elem,evt,listener){return map(arguments,function(elem,evt,listener){return elem.removeEventListener(evt,listener,!1),elem})};else{if(!("attachEvent"in document))throw new Error("Unsupported browser");DOM.addListener=function(elem,evt,listener){return map(arguments,function(elem,evt,listener){return elem.attachEvent("on"+evt,listener),elem})},DOM.removeListener=function(elem,evt,listener){return map(arguments,function(elem,evt,listener){return elem.detachEvent("on"+evt,listener),elem})}}var testElem=DOM.create("span"),prepare=function(args,asStr){return args=Arrays.createFrom(args,1).join(" ").trim(),asStr?args:args.split(/\s+/g)};"classList"in testElem?(testElem.classList.add("c1","c2"),testElem.classList.contains("c2")?(DOM.addClass=function(elem,classes){return classes=prepare(arguments),map([elem],function(elem){return elem.classList.add.apply(elem.classList,classes),elem})},DOM.removeClass=function(elem,classes){return classes=prepare(arguments),map([elem],function(elem){return elem.classList.remove.apply(elem.classList,classes),elem})}):(DOM.addClass=function(elem,classes){return classes=prepare(arguments),map([elem],function(elem){return classes.forEach(function(c){elem.classList.add(c)}),elem})},DOM.removeClass=function(elem,classes){return classes=prepare(arguments),map([elem],function(elem){return classes.forEach(function(c){elem.classList.remove(c)}),elem})}),testElem.classList.toggle("c1",!0),testElem.classList.contains("c1")?DOM.toggleClass=function(elem,classes,value){return classes=classes.trim().split(/\s+/g),map([elem],function(elem){return value===undefined?classes.forEach(function(c){elem.classList.toggle(c)}):classes.forEach(function(c){elem.classList.toggle(c,!!value)}),elem})}:DOM.toggleClass=function(elem,classes,value){return classes=classes.trim().split(/\s+/g),map([elem],function(elem){return classes.forEach(function(c){(value===undefined||value===elem.classList.contains(c))&&elem.classList.toggle(c)}),elem})},DOM.hasClass=function(elem,classes){elem=getElem(elem),classes=prepare(arguments);for(var i=0;i<classes.length;i++)if(!elem.classList.contains(classes[i]))return!1;return!0}):(DOM.addClass=function(elem,classes){return classes=prepare(arguments,!0),map([elem],function(elem){return elem.className+=(elem.className?" ":"")+classes,elem})},DOM.removeClass=function(elem,classes){return classes=prepare(arguments).map(Strings.escapeRegex),map([elem],function(elem){return elem.className?(elem.className=elem.className.replace(new RegExp("(?:^|s+)(?:"+classes.join("|")+"(?:s+|$)","g")," ").trim(),elem):elem})},DOM.toggleClass=function(elem,classes,value){return classes=classes.trim().split(/\s+/g),map([elem],function(elem){var current=(elem.className||"").trim().split(/\s+/g);return classes.forEach(function(c){var i=current.indexOf(c),has=i>-1;value===!1||has?value!==!0&&has&&current.splice(i,1):current.push(c)}),elem.className=current.join(" "),elem})},DOM.hasClass=function(elem,classes){if(elem=getElem(elem),!elem.className)return!1;classes=prepare(arguments);for(var current=elem.className.trim().split(/\s+/g),i=0;i<classes.length;i++)if(-1===current.indexOf(classes[i]))return!1;return!0});var reint=/^-?(?:(?:0|[1-9]\d*)|[1-9]\d*e(?:\+|-)\d+)$/i,refloat=/^-?(?:(?:0|[1-9]\d*)\.\d+|[1-9]\d*\.\d+e(?:\+|-)\d+)$/i,rebool=/^(?:true|false)$/i,renull=/^null$/i,parseData=function(value){switch(!0){case reint.test(value):return parseInt(value);case refloat.test(value):return parseFloat(value);case rebool.test(value):return"true"===value.toLowerCase();case renull.test(value):return null;default:try{return JSON.parse(value)}catch(e){return value}}};if(testElem.setAttribute("data-test-prop","test-value"),"dataset"in testElem&&"testProp"in testElem.dataset)DOM.getData=function(elem,key){return parseData(getElem(elem).dataset[key])},DOM.setData=function(elem,key,value){return map([elem],function(elem){return elem.dataset[key]=JSON.stringify(value),elem})};else{var key2attr=function(key){return"data-"+key.replace(/[A-Z]/g,function(m){return"-"+m[0].toLowerCase()})};DOM.getData=function(elem,key){return parseData(getElem(elem).getAttribute(key2attr(key)))},DOM.setData=function(elem,key,value){return map([elem],function(elem){return elem.setAttribute(key2attr(key),JSON.stringify(value)),elem})}}testElem=null,_context.register(DOM,"DOM")}),_context.invoke("Utils",function(undefined){var ReflectionClass=function(c){this._={reflectedClass:"string"==typeof c?ReflectionClass.getClass(c):c}};ReflectionClass.from=function(c){return c instanceof ReflectionClass?c:new ReflectionClass(c)},ReflectionClass.getClass=function(name){return _context.lookup(name)},ReflectionClass.getClassName=function(obj,need){var className=_context.lookupClass(obj);if(className===!1&&need)throw new Error("Unknown class");return className},ReflectionClass.prototype.hasProperty=function(name){return this._.reflectedClass.prototype[name]!==undefined&&"function"!=typeof this._.reflectedClass.prototype[name]},ReflectionClass.prototype.hasMethod=function(name){return this._.reflectedClass.prototype[name]!==undefined&&"function"==typeof this._.reflectedClass.prototype[name]},ReflectionClass.prototype.newInstance=function(){return this.newInstanceArgs(arguments)},ReflectionClass.prototype.newInstanceArgs=function(args){var inst,ret,tmp=function(){};return tmp.prototype=this._.reflectedClass.prototype,inst=new tmp,ret=this._.reflectedClass.apply(inst,args),Object(ret)===ret?ret:inst},_context.register(ReflectionClass,"ReflectionClass")}),_context.invoke("Utils",function(Arrays,undefined){var ReflectionFunction=function(f){this._={reflectedFunction:f,argsList:f.length?f.toString().match(/^function\s*\(\s*(.*?)\s*\)/i)[1].split(/\s*,\s*/):[]}};ReflectionFunction.from=function(f){return f instanceof ReflectionFunction?f:new ReflectionFunction(f)},ReflectionFunction.prototype.invoke=function(context){var args=Arrays.createFrom(arguments);return args.shift(),this._.reflectedFunction.apply(context,args)},ReflectionFunction.prototype.getArgs=function(){return this._.argsList},ReflectionFunction.prototype.invokeArgs=function(context,args){for(var list=[],i=0;i<this._.argsList.length;i++){if(args[this._.argsList[i]]===undefined)throw new Error('Parameter "'+this._.argsList[i]+'" was not provided in argument list');list.push(args[this._.argsList[i]])}return this._.reflectedFunction.apply(context,list)},_context.register(ReflectionFunction,"ReflectionFunction")}),_context.invoke("Nittro",function(){var prepare=function(self,need){if(!self._){if(need===!1)return!1;self._={}}if(!self._.eventEmitter){if(need===!1)return!1;self._.eventEmitter={listeners:{},defaultListeners:{},namespaces:[]}}},prepareNamespaces=function(emitter,namespaces){return namespaces.map(function(ns){var i=emitter.namespaces.indexOf(ns);return i>-1?i:(i=emitter.namespaces.length,emitter.namespaces.push(ns),i)})},hasCommonElement=function(a,b){for(var i=0,j=0;i<a.length&&j<b.length;)if(a[i]<b[j])i++;else{if(!(a[i]>b[j]))return!0;j++}return!1},process=function(emitter,evt,op,arg1,arg2){evt=(evt||"").replace(/^\s+|\s+$/g,"").split(/\s+/g),evt.forEach(function(e){var dflt=e.split(/:/),ns=dflt[0].split(/\./g);e=ns.shift(),ns=prepareNamespaces(emitter,ns),ns.sort(),op(emitter,e,ns,"default"===dflt[1],arg1,arg2)})},add=function(emitter,evt,ns,dflt,handler,mode){if(!evt)throw new TypeError("No event specified");if(dflt){if(0!==mode||ns.length)throw new TypeError("Default event handlers don't support namespaces and one()/first()");if(emitter.defaultListeners.hasOwnProperty(evt))throw new TypeError("Event '"+evt+"' already has a default listener");return void(emitter.defaultListeners[evt]=handler)}2===mode&&ns.unshift(emitter.namespaces.length),emitter.listeners[evt]||(emitter.listeners[evt]=[]),emitter.listeners[evt].push({handler:handler,namespaces:ns,mode:mode})},remove=function(emitter,evt,ns,dflt,handler){if(evt)return dflt?void(!emitter.defaultListeners.hasOwnProperty(evt)||handler&&emitter.defaultListeners[evt]!==handler||delete emitter.defaultListeners[evt]):void(emitter.listeners[evt]&&(ns.length?emitter.listeners[evt]=emitter.listeners[evt].filter(function(listener){return handler&&listener.handler!==handler?!0:!listener.namespaces.length||!hasCommonElement(listener.namespaces,ns)}):handler?emitter.listeners[evt]=emitter.listeners[evt].filter(function(listener){return listener.handler!==handler}):(emitter.listeners.hasOwnProperty(evt)&&delete emitter.listeners[evt],emitter.defaultListeners.hasOwnProperty(evt)&&delete emitter.defaultListeners[evt])));var listeners=dflt?emitter.defaultListeners:emitter.listeners;for(evt in listeners)listeners.hasOwnProperty(evt)&&remove(emitter,evt,ns,dflt,handler)},trigger=function(self,evt,data){var e,_=self._.eventEmitter;return"object"!=typeof evt&&(e=new NittroEvent(evt,data)),_.listeners.hasOwnProperty(evt)&&_.listeners[evt].slice().forEach(function(listener){1===listener.mode?remove(_,evt,[],!1,listener.handler):2===listener.mode&&remove(_,"",[listener.namespaces[0]],!1),listener.handler.call(self,e)}),!e.isDefaultPrevented()&&_.defaultListeners.hasOwnProperty(evt)&&_.defaultListeners[evt].call(self,e),e},NittroEventEmitter={on:function(evt,handler){return prepare(this),process(this._.eventEmitter,evt,add,handler,0),this},one:function(evt,handler){return prepare(this),process(this._.eventEmitter,evt,add,handler,1),this},first:function(evt,handler){return prepare(this),process(this._.eventEmitter,evt,add,handler,2),this._.eventEmitter.namespaces.push(null),this},off:function(evt,handler){return prepare(this,!1)===!1?this:(process(this._.eventEmitter,evt,remove,handler),this)},trigger:function(evt,data){return prepare(this,!1)===!1?this:trigger(this,evt,data)}},returnTrue=function(){return!0},returnFalse=function(){return!1},NittroEvent=_context.extend(function(type,data){this.type=type,this.data=data||{}},{preventDefault:function(){this.isDefaultPrevented=returnTrue},isDefaultPrevented:returnFalse});_context.register(NittroEventEmitter,"EventEmitter"),_context.register(NittroEvent,"Event")}),_context.invoke("Nittro",function(){var prepare=function(self,need){if(!self._){if(need===!1)return!1;self._={}}if(!self._.hasOwnProperty("frozen")){if(need===!1)return!1;self._.frozen=!1}},Freezable={freeze:function(){return prepare(this),this._.frozen=!0,this},isFrozen:function(){return prepare(this,!1)===!1?!1:this._.frozen},_updating:function(prop){if(prepare(this,!1)===!1)return this;if(this._.frozen){var className=_context.lookupClass(this)||"object";throw prop&&(prop=' "'+prop+'"'),new Error("Cannot update property"+prop+" of a frozen "+className)}return this}};_context.register(Freezable,"Freezable")}),_context.invoke("Nittro",function(){var Object=_context.extend(function(){this._={}},{});_context.mixin(Object,"Nittro.EventEmitter"),_context.register(Object,"Object")}),_context.invoke("Nittro.Ajax",function(undefined){var FormData=_context.extend(function(){this._dataStorage=[],this._upload=!1},{append:function(name,value){if(value===undefined||null===value)return this;if(this._isFile(value))this._upload=!0;else{if("object"==typeof value&&"valueOf"in value&&/string|number|boolean/.test(typeof value.valueOf())&&!arguments[2])return this.append(name,value.valueOf(),!0);if(!/string|number|boolean/.test(typeof value))throw new Error("Only scalar values and File/Blob objects can be appended to FormData, "+typeof value+" given")}return this._dataStorage.push({name:name,value:value}),this},isUpload:function(){return this._upload},_isFile:function(value){return window.File!==undefined&&value instanceof window.File||window.Blob!==undefined&&value instanceof window.Blob},mergeData:function(data){for(var i=0;i<data.length;i++)this.append(data[i].name,data[i].value);return this},exportData:function(forcePlain){if(!forcePlain&&this.isUpload()&&window.FormData!==undefined){var i,fd=new window.FormData;for(i=0;i<this._dataStorage.length;i++)fd.append(this._dataStorage[i].name,this._dataStorage[i].value);return fd}return this._dataStorage.filter(function(e){return!this._isFile(e.value)},this)}});_context.register(FormData,"FormData")}),_context.invoke("Nittro.Ajax",function(Url,FormData,undefined){var Request=_context.extend("Nittro.Object",function(url,method,data){this._={url:Url.from(url),method:(method||"GET").toUpperCase(),data:data||{},headers:{},normalized:!1,aborted:!1}},{getUrl:function(){return this._normalize(),this._.url},getMethod:function(){return this._.method},isGet:function(){return"GET"===this._.method},isPost:function(){return"POST"===this._.method},isMethod:function(method){return method.toUpperCase()===this._.method},getData:function(){return this._normalize(),this._.data},getHeaders:function(){return this._.headers},setUrl:function(url){return this._updating("url"),this._.url=Url.from(url),this},setMethod:function(method){return this._updating("method"),this._.method=method.toLowerCase(),this},setData:function(k,v){if(this._updating("data"),null===k)this._.data={};else if(v===undefined&&"object"==typeof k)for(v in k)k.hasOwnProperty(v)&&(this._.data[v]=k[v]);else this._.data[k]=v;return this},setHeader:function(header,value){return this._updating("headers"),this._.headers[header]=value,this},setHeaders:function(headers){this._updating("headers");for(var header in headers)headers.hasOwnProperty(header)&&(this._.headers[header]=headers[header]);return this},abort:function(){return this._.aborted||(this._.aborted=!0,this.trigger("abort")),this},isAborted:function(){return this._.aborted},_normalize:function(){!this._.normalized&&this.isFrozen()&&(this._.normalized=!0,("GET"===this._.method||"HEAD"===this._.method)&&(this._.url.addParams(this._.data instanceof FormData?this._.data.exportData(!0):this._.data),this._.data={}))}});_context.mixin(Request,"Nittro.Freezable"),_context.register(Request,"Request")},{Url:"Utils.Url"}),_context.invoke("Nittro.Ajax",function(){var Response=_context.extend(function(status,payload,headers){this._={status:status,payload:payload,headers:headers}},{getStatus:function(){return this._.status},getPayload:function(){return this._.payload},getHeader:function(name){return this._.headers[name.toLowerCase()]},getAllHeaders:function(){return this._.headers}});_context.register(Response,"Response")}),_context.invoke("Nittro.Ajax",function(Request){var Service=_context.extend("Nittro.Object",function(){Service.Super.call(this),this._.transports=[]},{addTransport:function(transport){return this._.transports.push(transport),this},get:function(url,data){return this.dispatch(this.createRequest(url,"get",data))},post:function(url,data){return this.dispatch(this.createRequest(url,"post",data))},createRequest:function(url,method,data){var request=new Request(url,method,data);return this.trigger("request-created",{request:request}),request},dispatch:function(request){request.freeze();for(var i=0;i<this._.transports.length;i++)try{return this._.transports[i].dispatch(request)}catch(e){console.log(e)}throw new Error("No transport is able to dispatch this request")}});_context.register(Service,"Service")}),_context.invoke("Nittro.Ajax.Transport",function(Response,FormData,Url){var Native=_context.extend(function(){},{STATIC:{createXhr:function(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject)try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){return new ActiveXObject("Microsoft.XMLHTTP")}}},dispatch:function(request){var xhr=Native.createXhr(),adv=this.checkSupport(xhr),self=this,abort=function(){xhr.abort()},cleanup=function(){request.off("abort",abort)};return request.on("abort",abort),new Promise(function(fulfill,reject){request.isAborted()&&(cleanup(),reject(self._createError(xhr,{type:"abort"}))),self._bindEvents(request,xhr,adv,cleanup,fulfill,reject),xhr.open(request.getMethod(),request.getUrl().toAbsolute(),!0);var data=self._formatData(request,xhr);self._addHeaders(request,xhr),xhr.send(data)})},checkSupport:function(xhr){var adv;if(!((adv="addEventListener"in xhr)||"onreadystatechange"in xhr))throw new Error("Unsupported XHR implementation");return adv},_bindEvents:function(request,xhr,adv,cleanup,fulfill,reject){var self=this,onLoad=function(evt){if(cleanup(),200===xhr.status){var response=self._createResponse(xhr);request.trigger("success",response),fulfill(response)}else{var err=self._createError(xhr,evt);request.trigger("error",err),reject(err)}},onError=function(evt){cleanup();var err=self._createError(xhr,evt);request.trigger("error",err),reject(err)},onProgress=function(evt){request.trigger("progress",{lengthComputable:evt.lengthComputable,loaded:evt.loaded,total:evt.total})};adv?(xhr.addEventListener("load",onLoad,!1),xhr.addEventListener("error",onError,!1),xhr.addEventListener("abort",onError,!1),"upload"in xhr&&xhr.upload.addEventListener("progress",onProgress,!1)):(xhr.onreadystatechange=function(){4===xhr.readyState&&(200===xhr.status?onLoad():onError())},"ontimeout"in xhr&&(xhr.ontimeout=onError),"onerror"in xhr&&(xhr.onerror=onError),"onload"in xhr&&(xhr.onload=onLoad))},_addHeaders:function(request,xhr){var h,headers=request.getHeaders();for(h in headers)headers.hasOwnProperty(h)&&xhr.setRequestHeader(h,headers[h]);headers.hasOwnProperty("X-Requested-With")||xhr.setRequestHeader("X-Requested-With","XMLHttpRequest")},_formatData:function(request,xhr){var data=request.getData();return data instanceof FormData?(data=data.exportData(request.isGet()||request.isMethod("HEAD")),data instanceof window.FormData||(data=Url.buildQuery(data,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"))):(data=Url.buildQuery(data),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded")),data},_createResponse:function(xhr){var payload,headers={};return(xhr.getAllResponseHeaders()||"").trim().split(/\r\n/g).forEach(function(header){header&&!header.match(/^\s+$/)&&(header=header.match(/^\s*([^:]+):\s*(.+)\s*$/),headers[header[1].toLowerCase()]=header[2])}),payload="application/json"===headers["content-type"]?JSON.parse(xhr.responseText||"{}"):xhr.responseText,new Response(xhr.status,payload,headers)},_createError:function(xhr,evt){var response=null;return 4===xhr.readyState&&0!==xhr.status&&(response=this._createResponse(xhr)),evt&&"abort"===evt.type?{type:"abort",status:null,response:response}:0===xhr.status?{type:"connection",status:null,response:response}:200!==xhr.status?{type:"response",status:xhr.status,response:response}:{type:"unknown",status:xhr.status,response:response}}});_context.register(Native,"Native")},{Url:"Utils.Url",Response:"Nittro.Ajax.Response",FormData:"Nittro.Ajax.FormData"}),_context.invoke("Nittro.Page",function(DOM){var Snippet=_context.extend(function(id,state){this._={id:id,state:"number"==typeof state?state:Snippet.INACTIVE,handlers:[[],[],[],[]]}},{STATIC:{INACTIVE:-1,PREPARE_SETUP:0,RUN_SETUP:1,PREPARE_TEARDOWN:2,RUN_TEARDOWN:3},setup:function(prepare,run){return prepare&&!run&&(run=prepare,prepare=null),prepare&&(this._.state===Snippet.PREPARE_SETUP?prepare(this.getElement()):this._.handlers[Snippet.PREPARE_SETUP].push(prepare)),run&&(this._.state===Snippet.RUN_SETUP?run(this.getElement()):this._.handlers[Snippet.RUN_SETUP].push(run)),this},teardown:function(prepare,run){return prepare&&!run&&(run=prepare,prepare=null),prepare&&(this._.state===Snippet.PREPARE_TEARDOWN?prepare(this.getElement()):this._.handlers[Snippet.PREPARE_TEARDOWN].push(prepare)),run&&(this._.state===Snippet.RUN_TEARDOWN?run(this.getElement()):this._.handlers[Snippet.RUN_TEARDOWN].push(run)),this},setState:function(state){if(state===Snippet.INACTIVE)this._.state=state,this._.handlers.forEach(function(queue){queue.splice(0,queue.length)});else if((this._.state+1)%4===state){this._.state=state;var elm=this.getElement();this._.handlers[this._.state].forEach(function(handler){handler(elm)}),this._.handlers[this._.state].splice(0,this._.handlers[this._.state].length)}return this},getState:function(){return this._.state},getElement:function(){return DOM.getById(this._.id)}});_context.register(Snippet,"Snippet")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Page",function(DOM){var Transitions=_context.extend(function(duration){this._={duration:duration||!1,ready:!0,queue:[],support:!1,property:null};try{var s=DOM.create("span").style;this._.support=["transition","WebkitTransition","MozTransition","msTransition","OTransition"].some(function(prop){return prop in s?(this._.property=prop,!0):void 0}.bind(this)),s=null}catch(e){}},{transitionOut:function(elements){return this._begin(elements,"transition-out")},transitionIn:function(elements){return this._begin(elements,"transition-in")},_begin:function(elements,className){return this._.support&&this._.duration&&elements.length?this._resolve(elements,className):Promise.resolve(elements)},_resolve:function(elements,className){if(!this._.ready)return new Promise(function(resolve){this._.queue.push([elements,className,resolve])}.bind(this));if(this._.ready=!1,"transition-in"===className){window.pageXOffset}DOM.addClass(elements,"transition-active "+className),DOM.removeClass(elements,"transition-middle");var duration=this._getDuration(elements),promise=new Promise(function(resolve){window.setTimeout(function(){DOM.removeClass(elements,"transition-active "+className),"transition-out"===className&&DOM.addClass(elements,"transition-middle"),this._.ready=!0,resolve(elements)}.bind(this),duration)}.bind(this));return promise.then(function(){if(this._.queue.length){var q=this._.queue.shift();this._resolve(q[0],q[1]).then(function(){q[2](q[0])})}}.bind(this)),promise},_getDuration:function(elements){if(!window.getComputedStyle)return this._.duration;var durations=[],prop=this._.property+"Duration";return elements.forEach(function(elem){var duration=window.getComputedStyle(elem)[prop];duration&&(duration=(duration+"").trim().split(/\s*,\s*/g).map(function(v){return v=v.match(/^((?:\d*\.)?\d+)(m?s)$/),v?parseFloat(v[1])*("ms"===v[2]?1:1e3):0}),durations.push.apply(durations,duration.filter(function(v){return v>0})))}),durations.length?Math.max.apply(null,durations):this._.duration}});_context.register(Transitions,"Transitions")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Page",function(DOM,Arrays,Url,Snippet){var Service=_context.extend("Nittro.Object",function(ajax,transitions,flashMessages,options){Service.Super.call(this),this._.ajax=ajax,this._.transitions=transitions,this._.flashMessages=flashMessages,this._.snippets={},this._.request=null,this._.transitioning=null,this._.setup=!1,this._.currentPhase=Snippet.INACTIVE,this._.currentUrl=Url.fromCurrent(),this._.options=Arrays.mergeTree({},Service.defaults,options),DOM.addListener(document,"click",this._handleClick.bind(this)),DOM.addListener(document,"submit",this._handleSubmit.bind(this)),DOM.addListener(window,"popstate",this._handleState.bind(this)),this.on("error:default",this._showError.bind(this)),this._checkReady()},{STATIC:{defaults:{whitelistRedirects:!1,whitelistLinks:!0,whitelistForms:!0,defaultTransition:null}},setFormLocator:function(formLocator){return this._.formLocator=formLocator,this},open:function(url,method,data){return this._createRequest(url,method,data)},openLink:function(link,evt){return this._createRequest(link.href,"get",null,evt,link)},sendForm:function(form,evt){this._checkFormLocator(!0);var frm=this._.formLocator.getForm(form),data=frm.serialize();return this._createRequest(form.action,form.method,data,evt,form).then(function(){frm.reset()})},_checkFormLocator:function(need){if(this._.formLocator)return!0;if(!need)return!1;throw new Error("Nittro/Page service: Form support wasn't enabled. Please install Nittro/Application and inject the FormLocator service using the setFormLocator() method.")},_handleState:function(){var request,url=Url.fromCurrent();if(!(url.compare(this._.currentUrl)<=Url.PART.HASH)){this._.currentUrl=url,request=this._.ajax.createRequest(url);try{this._dispatchRequest(request)}catch(e){document.location.href=url.toAbsolute();
}}},_pushState:function(payload,url){payload.postGet&&(url=payload.url),this._.currentUrl=Url.from(url),window.history.pushState(null,payload.title||document.title,this._.currentUrl.toAbsolute())},_checkReady:function(){return"loading"===document.readyState?void DOM.addListener(document,"readystatechange",this._checkReady.bind(this)):void(this._.setup||(this._.setup=!0,window.setTimeout(function(){this._setup(),this._showHtmlFlashes(),this.trigger("update")}.bind(this),1)))},_checkLink:function(link){return this._.options.whitelistLinks?DOM.hasClass(link,"ajax"):!DOM.hasClass(link,"noajax")},_handleClick:function(evt){if(!(evt.defaultPrevented||evt.ctrlKey||evt.shiftKey||evt.altKey||evt.metaKey||this._checkFormLocator()&&this._handleButton(evt))){var url,link=DOM.closest(evt.target,"a");link&&this._checkLink(link)&&(url=Url.from(link.href),url.isLocal()&&url.compare()!==Url.PART.HASH&&this.openLink(link,evt))}},_checkForm:function(form){return this._.options.whitelistForms?DOM.hasClass(form,"ajax"):!DOM.hasClass(form,"noajax")},_handleButton:function(evt){var frm,btn=DOM.closest(evt.target,"button")||DOM.closest(evt.target,"input");return btn&&"submit"===btn.type?(btn.form&&this._checkForm(btn.form)&&(frm=this._.formLocator.getForm(btn.form),frm.setSubmittedBy(btn.name||null)),!0):void 0},_handleSubmit:function(evt){!evt.defaultPrevented&&this._checkFormLocator()&&evt.target instanceof HTMLFormElement&&this._checkForm(evt.target)&&this.sendForm(evt.target,evt)},_createRequest:function(url,method,data,evt,context){this._.request&&this._.request.abort();var request=this._.ajax.createRequest(url,method,data);try{var p=this._dispatchRequest(request,context,!0);return evt&&evt.preventDefault(),p}catch(e){return Promise.reject(e)}},_dispatchRequest:function(request,elem,pushState){this._.request=request;var transitionTargets,xhr=this._.ajax.dispatch(request),removeTarget=null,transition=null;elem&&(transitionTargets=this._getTransitionTargets(elem),removeTarget=this._getRemoveTarget(elem),removeTarget&&(DOM.addClass(removeTarget,"transition-remove"),transitionTargets.push(removeTarget)),transition=this._.transitions.transitionOut(transitionTargets),this._.transitioning=transitionTargets);var p=Promise.all([xhr,transition,removeTarget,pushState||!1]);return p.then(this._handleResponse.bind(this),this._handleError.bind(this)),p},_checkRedirect:function(payload){return!this._.options.whitelistRedirects!=!payload.allowAjax&&Url.from(payload.redirect).isLocal()},_handleResponse:function(queue){if(!this._.request)return void this._cleanup();var data,id,response=queue[0],transitionTargets=queue[1]||this._.transitioning||[],removeTarget=queue[2],pushState=queue[3],payload=response.getPayload(),setup={},teardown={},dynamic={};if("object"!=typeof payload||!payload)return void this._cleanup();if(data=payload&&"snippets"in payload?payload.snippets:{},payload&&"flashes"in payload&&this._showFlashes(payload.flashes),payload&&"redirect"in payload)return void(this._checkRedirect(payload)?this._dispatchRequest(this._.ajax.createRequest(payload.redirect),null,pushState):document.location.href=payload.redirect);pushState&&this._pushState(payload||{},this._.request.getUrl()),this._.request=this._.transitioning=null,removeTarget&&(this._cleanupChildSnippets(removeTarget,teardown),this._cleanupForms(removeTarget),this.isSnippet(removeTarget)&&(teardown[removeTarget.id]=!0));for(id in data)data.hasOwnProperty(id)&&this._prepareSnippet(id,setup,teardown,dynamic);this._teardown(teardown),removeTarget&&(transitionTargets.splice(transitionTargets.indexOf(removeTarget),1),removeTarget.parentNode.removeChild(removeTarget),removeTarget=null),this._setupDynamic(dynamic,data,setup,transitionTargets),this._setup(setup,data),this._showHtmlFlashes(),this.trigger("update",payload),this._.transitions.transitionIn(transitionTargets).then(function(){this._cleanupDynamic(dynamic)}.bind(this))},_cleanup:function(){this._.request=null,this._.transitioning&&(this._.transitions.transitionIn(this._.transitioning),this._.transitioning=null)},_showFlashes:function(flashes){var id,i;for(id in flashes)if(flashes.hasOwnProperty(id)&&flashes[id])for(i=0;i<flashes[id].length;i++)this._.flashMessages.add(null,flashes[id][i].type,flashes[id][i].message)},_showHtmlFlashes:function(){var i,n,data,elms=DOM.getByClassName("flashes-src");for(i=0,n=elms.length;n>i;i++)data=JSON.parse(elms[i].textContent.trim()),elms[i].parentNode.removeChild(elms[i]),this._showFlashes(data)},_handleError:function(err){this._cleanup(),this.trigger("error",err)},_showError:function(evt){this._.flashMessages.add(null,"error","There was an error processing your request. Please try again later.")},getSnippet:function(id){return this._.snippets[id]||(this._.snippets[id]=new Snippet(id,this._.currentPhase)),this._.snippets[id]},isSnippet:function(elem){return("string"==typeof elem?elem:elem.id)in this._.snippets},_prepareSnippet:function(id,setup,teardown,dynamic){this._.snippets[id]&&this._.snippets[id].getState()===Snippet.RUN_SETUP&&(teardown[id]=!1);var snippet=DOM.getById(id);snippet?(this._cleanupChildSnippets(snippet,teardown),this._cleanupForms(snippet),setup[id]=!0):dynamic[id]=!0},_cleanupChildSnippets:function(elem,teardown){for(var i in this._.snippets)this._.snippets.hasOwnProperty(i)&&this._.snippets[i].getState()===Snippet.RUN_SETUP&&this._.snippets[i].getElement()!==elem&&DOM.contains(elem,this._.snippets[i].getElement())&&(teardown[i]=!0)},_cleanupForms:function(snippet){if(this._checkFormLocator())if("form"===snippet.tagName.toLowerCase())this._.formLocator.removeForm(snippet);else{var i,forms=snippet.getElementsByTagName("form");for(i=0;i<forms.length;i++)this._.formLocator.removeForm(forms.item(i))}},_teardown:function(snippets){this._setSnippetsState(snippets,Snippet.PREPARE_TEARDOWN),this._setSnippetsState(snippets,Snippet.RUN_TEARDOWN),this._setSnippetsState(snippets,Snippet.INACTIVE),this.trigger("teardown");for(var id in snippets)snippets.hasOwnProperty(id)&&snippets[id]&&delete this._.snippets[id]},_setup:function(snippets,data){if(data)for(var id in snippets)snippets.hasOwnProperty(id)&&snippets[id]&&DOM.html(id,data[id]||"");this.trigger("setup"),this._setSnippetsState(this._.snippets,Snippet.PREPARE_SETUP),this._setSnippetsState(this._.snippets,Snippet.RUN_SETUP)},_setupDynamic:function(snippets,data,setup,transitionTargets){var id,snippet;for(id in snippets)snippets.hasOwnProperty(id)&&(snippet=this._prepareDynamic(id,data[id]))&&(transitionTargets.push(snippet),setup[id]=!1)},_cleanupDynamic:function(snippets){for(var id in snippets)snippets.hasOwnProperty(id)&&DOM.removeClass(DOM.getById(id),"transition-add")},_setSnippetsState:function(snippets,state){this._.currentPhase=state;for(var id in snippets)snippets.hasOwnProperty(id)&&this.getSnippet(id).setState(state)},_prepareDynamic:function(id,data){var container=null;if(DOM.getByClassName("snippet-container").some(function(elem){var pattern=new RegExp("^"+DOM.getData(elem,"dynamicMask")+"$");return pattern.test(id)?(container=elem,!0):void 0}),!container)return null;var elem=(DOM.getData(container,"dynamicElement")||"div").split(/\./g),insertMode=DOM.getData(container,"dynamicInsertMode")||"append";switch(elem[0]=DOM.create(elem[0],{id:id,"class":"transition-add"}),elem.length>1&&DOM.addClass.apply(null,elem),elem=elem[0],DOM.html(elem,data),insertMode){case"append":container.appendChild(elem);break;case"prepend":container.hasChildNodes()?container.insertBefore(elem,container.firstChild):container.appendChild(elem);break;default:if(!insertMode.match(/^sorted:/i))throw new TypeError("Invalid insert mode for dynamic snippet container "+container.getAttribute("id"));this._insertSortedSnippet(container,elem,insertMode.substr(7))}return elem},_insertSortedSnippet:function(container,snippet,descriptor){var x,d,s,a,o,e,val,i,f,search=[],children=DOM.getChildren(container),c=0,n=children.length;if(!n)return void container.appendChild(snippet);for(val=function(e,s,a,d){var n=e.getElementsByClassName(s);return n.length?a?n[0].getAttribute(a):d?DOM.getData(n[0],d):n[0].textContent:null},descriptor=descriptor.trim().split(/\s*;\s*/);descriptor.length;)if(x=descriptor.shift(),s=x.match(/^(.+?)(?:\[(.+?)\])?(?:<(.+?)>)?(?:\s+(.+?))?$/i)){if(o=s[4]||null,d=s[3]||null,a=s[2]||null,s=s[1],s.match(/^[^.]|[\s#\[>+:]/))throw new TypeError("Invalid selector for sorted insert mode in container #"+container.getAttribute("id"));search.push({sel:s.substr(1),attr:a,data:d,asc:o?o.match(/^[1tay]/i):!0,value:val(snippet,s.substr(1),a,d)})}for(s=0;s<search.length;s++){for(x=search[s],f=!1,i=c;n>i;i++)if(e=children[i],d=val(e,x.sel,x.attr,x.data),x.asc)if(x.value>d)c=i;else{if(x.value<d){n=i;break}f||(c=i,f=!0)}else if(x.value<d)c=i;else{if(x.value>d){n=i;break}f||(c=i,f=!0)}if(n===c)return void container.insertBefore(snippet,children[n]);if(n===c+1&&!f)return void(c>=children.length-1?container.appendChild(snippet):container.insertBefore(snippet,children[c+1]))}x.asc?n>=children.length?container.appendChild(snippet):container.insertBefore(snippet,children[n]):container.insertBefore(snippet,children[c])},_getTransitionTargets:function(elem){var sel=DOM.getData(elem,"transition")||this._.options.defaultTransition,elms=[];return sel?("string"==typeof sel&&(sel=sel.trim().split(/\s*,\s*/g)),sel.forEach(function(sel){if(sel.match(/^[^.#]|[\s\[>+:]/))throw new TypeError("Invalid transition selector, only single-level .class and #id are allowed");if("#"===sel.charAt(0))sel=DOM.getById(sel.substr(1)),sel&&elms.push(sel);else{var matching=DOM.getByClassName(sel.substr(1));elms.push.apply(elms,matching)}}),elms):elms},_getRemoveTarget:function(elem){var id=DOM.getData(elem,"dynamicRemove");return id?DOM.getById(id):null}});_context.register(Service,"Service")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays",Url:"Utils.Url"}),_context.invoke("Nittro.Widgets",function(DOM,Arrays){var FlashMessages=_context.extend(function(options){this._={options:Arrays.mergeTree({},FlashMessages.defaults,options),globalHolder:DOM.create("div",{"class":"flash-global-holder"})},this._.options.layer.appendChild(this._.globalHolder),this._.options.positioning||(this._.options.positioning=FlashMessages.basicPositioning)},{STATIC:{defaults:{layer:null,minMargin:20,positioning:null},basicPositioning:[function(target,elem,minMargin){var res={name:"below",left:target.left+(target.width-elem.width)/2,top:target.bottom};return target.bottom+elem.height+minMargin<window.innerHeight&&res.left>0&&res.left+elem.width<window.innerWidth?res:void 0},function(target,elem,minMargin){var res={name:"rightOf",left:target.right,top:target.top+(target.height-elem.height)/2};return target.right+elem.width+minMargin<window.innerWidth&&res.top>0&&res.top+elem.height<window.innerHeight?res:void 0},function(target,elem,minMargin){var res={name:"above",left:target.left+(target.width-elem.width)/2,top:target.top-elem.height};return target.top>elem.height+minMargin&&res.left>0&&res.left+elem.width<window.innerWidth?res:void 0},function(target,elem,minMargin){var res={name:"leftOf",left:target.left-elem.width,top:target.top+(target.height-elem.height)/2};return target.left>elem.width+minMargin&&res.top>0&&res.top+elem.height<window.innerHeight?res:void 0}]},add:function(target,type,content,rich){var elem=DOM.create("div",{"class":"flash flash-"+(type||"info")});target&&"string"==typeof target&&(target=DOM.getById(target)),rich?DOM.html(elem,content):elem.textContent=content,DOM.setStyle(elem,"opacity",0),this._.options.layer.appendChild(elem);var style={},timeout=Math.max(2e3,Math.round(elem.textContent.split(/\s+/).length/.003));if(target){var position,fixed=this._hasFixedParent(target),elemRect=this._getRect(elem),targetRect=this._getRect(target);fixed&&(style.position="fixed");for(var i=0;i<this._.options.positioning.length&&!(position=this._.options.positioning[i].call(null,targetRect,elemRect,this._.options.minMargin));i++);if(position)return style.left=position.left,style.top=position.top,fixed||(style.left+=window.pageXOffset,style.top+=window.pageYOffset),style.left+="px",style.top+="px",style.opacity="",DOM.setStyle(elem,style),void this._show(elem,position.name,timeout)}this._.globalHolder.appendChild(elem),DOM.setStyle(elem,"opacity",""),this._show(elem,"global",timeout)},_show:function(elem,position,timeout){DOM.addClass(elem,"flash-show flash-"+position),window.setTimeout(function(){window.pageYOffset;DOM.removeClass(elem,"flash-show"),this._bindHide(elem,timeout)}.bind(this),1)},_bindHide:function(elem,timeout){var hide=function(){DOM.removeListener(document,"mousemove",hide),DOM.removeListener(document,"mousedown",hide),DOM.removeListener(document,"keydown",hide),DOM.removeListener(document,"touchstart",hide),window.setTimeout(function(){DOM.addClass(elem,"flash-hide"),window.setTimeout(function(){elem.parentNode.removeChild(elem)},1e3)},timeout)}.bind(this);DOM.addListener(document,"mousemove",hide),DOM.addListener(document,"mousedown",hide),DOM.addListener(document,"keydown",hide),DOM.addListener(document,"touchstart",hide)},_hasFixedParent:function(elem){do{if("fixed"===elem.style.position)return!0;elem=elem.offsetParent}while(elem&&elem!==document.documentElement&&elem!==document.body);return!1},_getRect:function(elem){var rect=elem.getBoundingClientRect();return{left:rect.left,top:rect.top,right:rect.right,bottom:rect.bottom,width:"width"in rect?rect.width:rect.right-rect.left,height:"height"in rect?rect.height:rect.bottom-rect.top}}});_context.register(FlashMessages,"FlashMessages")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays"}),_context.invoke("Utils",function(undefined){function getValue(interval){return"number"==typeof interval?interval:interval instanceof DateInterval?interval.getLength():DateInterval.from(interval).getLength()}function formatAuto(interval,precision){precision===!0?precision=intervalNames.length:precision||(precision=2);var i,v,last,str=[],sign="";for(0>interval&&(sign="-",interval=-interval),i=0;i<intervalNames.length&&!(interval>=intervalLengths[i]&&(precision--,v=interval/intervalLengths[i],v=0===precision?Math.round(v):Math.floor(v),str.push(v+" "+intervalHelpers[i].toString(v)),interval-=v*intervalLengths[i],0===precision));i++);return str.length>2?(last=str.pop(),sign+str.join(separators[0])+(separators[1]||separators[0])+last):sign+str.join(separators[1]||separators[0])}function format(interval,pattern){var sign=0>interval?"-":"+";return interval=Math.abs(interval),(pattern+"").replace(/%(.)/g,function(m,f){var v,pad=!1;switch(f){case"%":return"%";case"y":m=intervalLengths[0];break;case"w":m=intervalLengths[1];break;case"m":pad=!0;case"n":m=intervalLengths[2];break;case"d":pad=!0;case"j":m=intervalLengths[3];break;case"H":pad=!0;case"G":m=intervalLengths[4];break;case"i":pad=!0;case"I":m=intervalLengths[5];break;case"s":pad=!0;case"S":m=intervalLengths[6];break;case"-":return"-"===sign?sign:"";case"+":return sign;default:throw new Error("Unknown format modifier: %"+f)}return v=Math.floor(interval/m),interval-=m*v,pad&&10>v?"0"+v:v})}var DateInterval=function(interval){this._={initialized:!1,interval:interval}};DateInterval.from=function(interval){return new DateInterval(interval)};var intervalNames=["year","month","week","day","hour","minute","second","millisecond"],intervalLengths=[31536e6,6048e5,26784e5,864e5,36e5,6e4,1e3,1],intervalHelpers=[{pattern:/^y(?:ears?)?$/,toString:function(n){return 1===n?"year":"years"}},{pattern:/^mon(?:ths?)?$/,toString:function(n){return 1===n?"month":"months"}},{pattern:/^w(?:eeks?)?$/,toString:function(n){return 1===n?"week":"weeks"}},{pattern:/^d(?:ays?)?$/,toString:function(n){return 1===n?"day":"days"}},{pattern:/^h(?:ours?)?$/,toString:function(n){return 1===n?"hour":"hours"}},{pattern:/^min(?:utes?)?$/,toString:function(n){return 1===n?"minute":"minutes"}},{pattern:/^s(?:ec(?:onds?)?)?$/,toString:function(n){return 1===n?"second":"seconds"}},{pattern:/^millis(?:econds?)?$|^ms$/,toString:function(n){return 1===n?"millisecond":"milliseconds"}}],separators=[", "," and "];DateInterval.setHelpers=function(helpers){intervalHelpers=helpers},DateInterval.setSeparators=function(separator,last){separators=[separator,last]},DateInterval.prototype.add=function(interval){return this._initialize(),this._.interval+=getValue(interval),this},DateInterval.prototype.subtract=function(interval){return this._initialize(),this._.interval-=getValue(interval),this},DateInterval.prototype.isNegative=function(){return this._initialize(),this._.interval<0},DateInterval.prototype.getLength=function(){return this._initialize(),this._.interval},DateInterval.prototype.valueOf=function(){return this.getLength()},DateInterval.prototype.format=function(pattern){return this._initialize(),"boolean"!=typeof pattern&&"number"!=typeof pattern&&pattern?format(this._.interval,pattern):formatAuto(this._.interval,pattern)},DateInterval.prototype._initialize=function(){if(!this._.initialized&&(this._.initialized=!0,"number"!=typeof this._.interval)){var interval=this._.interval;if(interval instanceof DateInterval)this._.interval=interval.getLength();else{if("string"!=typeof interval)throw new Error("Invalid interval specification, expected string, number or a DateInterval instance");if(interval.match(/^\s*(?:\+|-)?\s*\d+\s*$/))this._.interval=parseInt(interval.trim());else{var rest,res=0,sign=1;if(rest=interval.replace(/\s*(\+|-)?\s*(\d+)\s+(\S+)\s*/g,function(m,s,n,k){s!==undefined&&(sign="+"===s?1:-1),k=k.toLowerCase(),n=parseInt(n)*sign,m=null;for(var i=0;i<intervalHelpers.length;i++)if(intervalHelpers[i].pattern.test(k)){m=intervalLengths[i];break}if(null===m)throw new Error('Unknown keyword: "'+k+'"');return res+=n*m,""}),rest.length)throw new Error('Invalid interval specification "'+interval+'", didn\'t understand "'+rest+'"');this._.interval=res}}}},_context.register(DateInterval,"DateInterval")}),_context.invoke("Utils",function(Strings,Arrays,DateInterval,undefined){var DateTime=function(d){this._={initialized:!1,date:d||new Date}};DateTime.keywords={weekdays:{abbrev:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},months:{abbrev:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],full:["January","February","March","April","May","June","July","August","September","October","November","December"]},relative:{now:"now",today:"today",tomorrow:"tomorrow",yesterday:"yesterday",noon:"noon",midnight:"midnight",at:"at"}},DateTime.from=function(s){return new DateTime(s)},DateTime.now=function(){return new DateTime},DateTime.isDateObject=function(o){return"object"==typeof o&&o&&o.date!==undefined&&o.timezone!==undefined&&o.timezone_type!==undefined},DateTime.isLeapYear=function(y){return y%4===0&&y%100!==0||y%400===0},DateTime.isModifyString=function(str){var kw=DateTime.keywords.relative,re=new RegExp("(?:^(?:"+[kw.now,kw.yesterday,kw.tomorrow,kw.today].map(Strings.escapeRegex).join("|")+"))|"+Strings.escapeRegex(kw.noon)+"|"+Strings.escapeRegex(kw.midnight)+"|\\d?\\d(?::\\d\\d|\\s*(?:am|pm))(?:\\d\\d)?(?:\\s*(?:am|pm))?|(?:[-+]\\s*)?\\d+\\s+[^\\d\\s]","i");return re.test(str)},DateTime.getDaysInMonth=function(m,y){return 2===m?DateTime.isLeapYear(y)?29:28:m in{4:1,6:1,9:1,11:1}?30:31};var ni=function(){throw new Error("Not implemented!")},pad=function(n){return 10>n?"0"+n:n},formatTz=function(offset){return("string"==typeof offset||offset instanceof String)&&offset.match(/(\+|-)\d\d:\d\d/)?offset:("number"!=typeof offset&&(offset=parseInt(offset)),(0>offset?"+":"-")+pad(parseInt(Math.abs(offset)/60))+":"+pad(Math.abs(offset)%60))};DateTime.getLocalTzOffset=function(){return formatTz((new Date).getTimezoneOffset())},DateTime.formatModifiers={d:function(d,u){return pad(u?d.getUTCDate():d.getDate())},D:function(d,u){return DateTime.keywords.weekdays.abbrev[u?d.getUTCDay():d.getDay()]},j:function(d,u){return u?d.getUTCDate():d.getDate()},l:function(d,u){return DateTime.keywords.weekdays.full[u?d.getUTCDay():d.getDay()]},N:function(d,u,n){return n=u?d.getUTCDay():d.getDay(),0===n?7:n},S:function(d,u,n){return n=u?d.getUTCDate():d.getDate(),n%=10,0===n||n>3?"th":["st","nd","rd"][n-1]},w:function(d,u){return u?d.getUTCDay():d.getDay()},z:function(d,u,n,m,y,M){for(n=u?d.getUTCDate():d.getDate(),n--,y=u?d.getUTCFullYear():d.getFullYear(),m=0,M=u?d.getUTCMonth():d.getMonth();M>m;)n+=DateTime.getDaysInMonth(m++,y);return n},W:ni,F:function(d,u){return DateTime.keywords.months.full[u?d.getUTCMonth():d.getMonth()]},m:function(d,u){return pad((u?d.getUTCMonth():d.getMonth())+1)},M:function(d,u){return DateTime.keywords.months.abbrev[u?d.getUTCMonth():d.getMonth()]},n:function(d,u){return(u?d.getUTCMonth():d.getMonth())+1},t:function(d,u){return DateTime.getDaysInMonth(u?d.getUTCMonth():d.getMonth(),u?d.getUTCFullYear():d.getFullYear())},L:function(d,u){return DateTime.isLeapYear(u?d.getUTCFullYear():d.getFullYear())?1:0},o:ni,Y:function(d,u){return u?d.getUTCFullYear():d.getFullYear()},y:function(d,u){return(u?d.getUTCFullYear():d.getFullYear()).toString().substr(-2)},a:function(d,u,h){return h=u?d.getUTCHours():d.getHours(),h>=0&&12>h?"am":"pm"},A:function(d,u){return DateTime.formatModifiers.a(d,u).toUpperCase()},g:function(d,u,h){return h=u?d.getUTCHours():d.getHours(),0===h?12:h>12?h-12:h},G:function(d,u){return u?d.getUTCHours():d.getHours()},h:function(d,u){return pad(DateTime.formatModifiers.g(d,u))},H:function(d,u){return pad(u?d.getUTCHours():d.getHours())},i:function(d,u){return pad(u?d.getUTCMinutes():d.getMinutes())},s:function(d,u){return pad(u?d.getUTCSeconds():d.getSeconds())},u:function(d,u){return 1e3*(u?d.getUTCMilliseconds():d.getMilliseconds())},e:ni,I:ni,O:function(d,u){return DateTime.formatModifiers.P(d,u).replace(":","")},P:function(d,u){return u?"+00:00":formatTz(d.getTimezoneOffset())},T:ni,Z:function(d,u){return u?0:-60*d.getTimezoneOffset()},c:function(d,u){return DateTime.from(d).format("Y-m-d\\TH:i:sP",u)},r:function(d,u){return DateTime.from(d).format("D, n M Y G:i:s O",u)},U:function(d){return Math.round(d.getTime()/1e3)}},DateTime.prototype.format=function(f,utc){this._initialize();var d=this._.date,pattern=Strings.escapeRegex(Arrays.getKeys(DateTime.formatModifiers).join(",")).replace(/,/g,"|"),re=new RegExp("(\\\\*)("+pattern+")","g");return f.replace(re,function(s,c,m){return c.length%2?c.substr(1)+m:c+""+DateTime.formatModifiers[m](d,utc)})},["getTime","getDate","getDay","getMonth","getFullYear","getHours","getMinutes","getSeconds","getMilliseconds","getTimezoneOffset","getUTCDate","getUTCDay","getUTCMonth","getUTCFullYear","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","toDateString","toISOString","toJSON","toLocaleDateString","toLocaleFormat","toLocaleTimeString","toString","toTimeString","toUTCString"].forEach(function(method){DateTime.prototype[method]=function(){return this._initialize(),this._.date[method].apply(this._.date,arguments)}}),["setTime","setDate","setMonth","setFullYear","setHours","setMinutes","setSeconds","setMilliseconds","setUTCDate","setUTCMonth","setUTCFullYear","setUTCHours","setUTCMinutes","setUTCSeconds","setUTCMilliseconds"].forEach(function(method){DateTime.prototype[method]=function(){return this._initialize(),this._.date[method].apply(this._.date,arguments),this}}),DateTime.prototype.getTimestamp=function(){return this._initialize(),Math.round(this._.date.getTime()/1e3)},DateTime.prototype.getDateObject=function(){return this._initialize(),this._.date},DateTime.prototype.valueOf=function(){return this.getTimestamp()},DateTime.prototype.modify=function(s){this._initialize();var r,re,t=this._.date.getTime(),kw=DateTime.keywords.relative;if(s instanceof DateInterval)return this._.date=new Date(t+s.getLength()),this;if(s=s.toLowerCase(),re=new RegExp("^("+[kw.yesterday,kw.tomorrow,kw.now,kw.today].map(Strings.escapeRegex).join("|")+")\\s*(?:"+Strings.escapeRegex(kw.at)+"\\s*)?"),r=s.match(re))switch(s=s.substr(r[0].length),r[1]){case kw.now:case kw.today:t=Date.now();break;case kw.yesterday:t-=864e5;break;case kw.tomorrow:t+=864e5}return re=new RegExp("^("+Strings.escapeRegex(kw.noon)+"|"+Strings.escapeRegex(kw.midnight)+"|\\d\\d?(?::\\d\\d|\\s*(?:am|pm))(?::\\d\\d)?(?:\\s*(?:am|pm))?)\\s*"),(r=s.match(re))&&(s=s.substr(r[0].length),t=new Date(t),r[1]===kw.noon?t.setHours(12,0,0,0):r[1]===kw.midnight?t.setHours(0,0,0,0):(r=r[1].match(/^(\d\d?)(?::(\d\d))?(?::(\d\d))?(?:\s*(am|pm))?$/),r[1]=parseInt(r[1]),r[2]=r[2]?parseInt(r[2]):0,r[3]=r[3]?parseInt(r[3]):0,r[4]&&("am"===r[4]&&12===r[1]?r[1]=0:"pm"===r[4]&&r[1]<12&&(r[1]+=12)),t.setHours(r[1],r[2],r[3],0)),t=t.getTime()),s.length&&!s.match(/^\s+$/)&&(t+=DateInterval.from(s).getLength()),this._.date=new Date(t),this},DateTime.prototype.modifyClone=function(s){return DateTime.from(this).modify(s)},DateTime.prototype._initialize=function(){if(!this._.initialized)if(this._.initialized=!0,"string"==typeof this._.date){var m;if(m=this._.date.match(/^@(\d+)$/))this._.date=new Date(1e3*m[1]);else if(m=this._.date.match(/^(\d\d\d\d-\d\d-\d\d)[ T](\d\d:\d\d(?::\d\d(?:\.\d+)?)?)([-+]\d\d:?\d\d)?$/))this._.date=new Date(m[1]+"T"+m[2]+(m[3]||""));else if(DateTime.isModifyString(this._.date)){var s=this._.date;this._.date=new Date,this.modify(s)}else this._.date=new Date(this._.date)}else if("number"==typeof this._.date)this._.date=new Date(this._.date);else if(DateTime.isDateObject(this._.date)){var s=this._.date.date;(3!==this._.date.timezone_type||"UTC"===this._.date.timezone)&&(s+=" "+this._.date.timezone),this._.date=new Date(s)}else this._.date instanceof DateTime&&(this._.date=new Date(this._.date.getTime()))},_context.register(DateTime,"DateTime")}),_context.invoke("Nittro.Utils",function(Nittro,Strings,Arrays,HashMap,undefined){var Tokenizer=_context.extend(function(patterns,matchCase){var types=!1;if(!Arrays.isArray(patterns))if(patterns instanceof HashMap)types=patterns.getKeys(),patterns=patterns.getValues();else{var type,tmp=patterns;types=[],patterns=[];for(type in tmp)tmp.hasOwnProperty(type)&&(types.push(type),patterns.push(tmp[type]))}this._={pattern:"("+patterns.join(")|(")+")",types:types,matchCase:matchCase}},{STATIC:{getCoordinates:function(text,offset){text=text.substr(0,offset);var m=text.match(/\n/g);return[(m?m.length:0)+1,offset-("\n"+text).lastIndexOf("\n")+1]}},tokenize:function(input){var re,tokens,pos,n;return this._.types?(re=new RegExp(this._.pattern,"gm"+(this._.matchCase?"":"i")),tokens=[],pos=0,n=this._.types.length,input.replace(re,function(){var i,ofs=arguments[n+1];for(ofs>pos&&tokens.push([input.substr(pos,ofs-pos),pos,null]),i=1;n>=i;i++)if(arguments[i]!==undefined)return tokens.push([arguments[i],ofs,this._.types[i-1]]),void(pos=ofs+arguments[0].length);throw new Error("Unknown token type: "+arguments[0])}.bind(this)),pos+1<input.length&&tokens.push([input.substr(pos),pos,null])):tokens=Strings.split(input,new RegExp(this._.pattern,"m"+(this._.matchCase?"":"i")),!0,!0,!0),tokens}});_context.register(Tokenizer,"Tokenizer")},{Strings:"Utils.Strings",Arrays:"Utils.Arrays",HashMap:"Utils.HashMap"}),_context.invoke("Nittro.Neon",function(Nittro,HashMap,Tokenizer,Strings,Arrays,DateTime,undefined){var Neon=_context.extend(function(){this._cbStr=this._cbStr.bind(this)},{STATIC:{patterns:["'[^'\\n]*'|\"(?:\\\\.|[^\"\\\\\\n])*\"","(?:[^#\"',:=[\\]{}()\x00- !`-]|[:-][^\"',\\]})\\s])(?:[^,:=\\]})(\x00- ]|:(?![\\s,\\]})]|$)|[ \\t]+[^#,:=\\]})(\x00- ])*","[,:=[\\]{}()-]","?:#.*","\\n[\\t ]*","?:[\\t ]+"],brackets:{"{":"}","[":"]","(":")"},consts:{"true":!0,True:!0,TRUE:!0,yes:!0,Yes:!0,YES:!0,on:!0,On:!0,ON:!0,"false":!1,False:!1,FALSE:!1,no:!1,No:!1,NO:!1,off:!1,Off:!1,OFF:!1,"null":null,Null:null,NULL:null},indent:"    ",BLOCK:1,encode:function(data,options){var tmp,s,isList;return data instanceof DateTime?data.format("Y-m-d H:i:s O"):data instanceof NeonEntity?(tmp=Neon.encode(data.attributes),Neon.encode(data.value)+"("+tmp.substr(1,tmp.length-2)+")"):data&&"object"==typeof data?(s=[],isList=Arrays.isArray(data),options&Neon.BLOCK?(Arrays.walk(data,function(k,v){v=Neon.encode(v,Neon.BLOCK),s.push(isList?"-":Neon.encode(k)+":",Strings.contains(v,"\n")?"\n"+Neon.indent+v.replace(/\n/g,"\n"+Neon.indent):" "+v,"\n")}),s.length?s.join(""):"[]"):(Arrays.walk(data,function(k,v){s.push(isList?"":Neon.encode(k)+": ",Neon.encode(v),", ")}),s.pop(),(isList?"[":"{")+s.join("")+(isList?"]":"}"))):"string"!=typeof data||Strings.isNumeric(data)||data.match(/[\x00-\x1F]|^\d{4}|^(true|false|yes|no|on|off|null)$/i)||!data.match(new RegExp("^"+Neon.patterns[1]+"$"))?JSON.stringify(data):data},decode:function(input){if("string"!=typeof input)throw new Error("Invalid argument, must be a string");Neon.tokenizer||(Neon.tokenizer=new Tokenizer(Neon.patterns)),input=input.replace(/\r/g,"");var res,parser=new Neon;for(parser.input=input,parser.tokens=Neon.tokenizer.tokenize(input),res=parser.parse(0,new HashMap);parser.tokens[parser.n]!==undefined;)"\n"===parser.tokens[parser.n][0].charAt(0)?parser.n++:parser.error();return res}},input:null,tokens:null,n:0,indentTabs:null,parse:function(indent,result){indent===undefined&&(indent=null),result===undefined&&(result=new HashMap);for(var t,inlineParser=null===indent,value=null,key=null,entity=null,hasValue=!1,hasKey=!1;this.n<this.tokens.length;this.n++)if(t=this.tokens[this.n][0],","===t)(hasKey||hasValue)&&inlineParser||this.error(),this.addValue(result,hasKey,key,hasValue?value:null),hasKey=hasValue=!1;else if(":"===t||"="===t)(hasKey||!hasValue)&&this.error(),"string"!=typeof value&&"number"!=typeof value&&this.error("Unacceptable key"),key=Strings.toString(value),hasKey=!0,hasValue=!1;else if("-"===t)(hasKey||hasValue||inlineParser)&&this.error(),key=null,hasKey=!0;else if(Neon.brackets[t]!==undefined)hasValue?("("!==t&&this.error(),this.n++,entity=new NeonEntity,entity.value=value,entity.attributes=this.parse(null,new HashMap),value=entity):(this.n++,value=this.parse(null,new HashMap)),hasValue=!0,(this.tokens[this.n]===undefined||this.tokens[this.n][0]!==Neon.brackets[t])&&this.error();else{if("}"===t||"]"===t||")"===t){inlineParser||this.error();break}if("\n"===t.charAt(0))if(inlineParser)(hasKey||hasValue)&&(this.addValue(result,hasKey,key,hasValue?value:null),hasKey=hasValue=!1);else{for(;this.tokens[this.n+1]!==undefined&&"\n"===this.tokens[this.n+1][0].charAt(0);)this.n++;if(this.tokens[this.n+1]===undefined)break;var newIndent=this.tokens[this.n][0].length-1;if(null===indent&&(indent=newIndent),newIndent&&(null===this.indentTabs&&(this.indentTabs="	"===this.tokens[this.n][0].charAt(1)),Strings.contains(this.tokens[this.n][0],this.indentTabs?" ":"	")&&(this.n++,this.error("Either tabs or spaces may be used for indentation, not both"))),newIndent>indent)hasValue||!hasKey?(this.n++,this.error("Unexpected indentation")):this.addValue(result,null!==key,key,this.parse(newIndent,new HashMap)),newIndent=this.tokens[this.n]!==undefined?this.tokens[this.n][0].length-1:0,hasKey=!1;else{if(hasValue&&!hasKey)break;hasKey&&(this.addValue(result,null!==key,key,hasValue?value:null),hasKey=hasValue=!1)}if(indent>newIndent)return result}else hasValue&&this.error(),value='"'===t.charAt(0)?t.substr(1,t.length-2).replace(/\\(?:u[0-9a-f]{4}|x[0-9a-f]{2}|.)/gi,this._cbStr):"'"===t.charAt(0)?t.substr(1,t.length-2):Neon.consts[t]!==undefined?Neon.consts[t]:Strings.isNumeric(t)?parseFloat(t):t.match(/^\d\d\d\d-\d\d?-\d\d?(?:(?:[Tt]| +)\d\d?:\d\d(?::\d\d(?:\.\d*)?)? *(?:Z|[-+]\d\d?(?::?\d\d)?)?)?$/)?DateTime.from(t):t,hasValue=!0}return inlineParser?(hasKey||hasValue)&&this.addValue(result,hasKey,key,hasValue?value:null):hasValue&&!hasKey?result.length?this.error():result=value:hasKey&&this.addValue(result,null!==key,key,hasValue?value:null),result},addValue:function(result,hasKey,key,value){hasKey?(result&&result.has(key)&&this.error("Duplicated key "+key),result.set(key,value)):result.push(value)},_cbStr:function(m){var mapping={t:"	",n:"\n",r:"\r",f:"\f",b:"\b",'"':'"',"\\":"\\","/":"/",_:"Â "};return mapping[m.charAt(1)]!==undefined?mapping[m.charAt(1)]:"u"===m.charAt(1)&&6===m.length?String.fromCharCode(parseInt(m.substr(2),16)):"x"===m.charAt(1)&&4===m.length?String.fromCharCode(parseInt(m.substr(2),16)):void this.error("Invalid escape sequence "+m);
},error:function(msg){var last=this.tokens[this.n]!==undefined?this.tokens[this.n]:null,pos=Tokenizer.getCoordinates(this.input,last?last[1]:this.input.length),token=last?last[0].substr(0,40).replace(/\n/g,"<new line>"):"end";throw new Error((msg||"Unexpected %s").replace(/%s/g,token)+" on line "+pos[0]+", column "+pos[1])}}),NeonEntity=this.NeonEntity=function(value,attributes){this.value=value||null,this.attributes=attributes||null};_context.register(Neon,"Neon"),_context.register(NeonEntity,"NeonEntity")},{HashMap:"Utils.HashMap",Strings:"Utils.Strings",Arrays:"Utils.Arrays",DateTime:"Utils.DateTime",Tokenizer:"Nittro.Utils.Tokenizer"}),_context.invoke("Nittro.Forms",function(DOM,Arrays){if(!window.Nette||!window.Nette.validators)throw new Error("Nette/Forms vendor netteForms.js asset has not been loaded");var VendorForms=window.Nette;_context.register(VendorForms,"Vendor"),VendorForms.addEvent=DOM.addListener,VendorForms.validators.mimeType=function(elem,arg,val){Arrays.isArray(arg)||(arg=arg.trim().split(/\s*,\s*/));try{if(!val.length)return!1;for(var i=0;i<val.length;i++)if(-1===arg.indexOf(val[i].type)&&-1===arg.indexOf(val[i].type.replace(/\/.*/,"/*")))return!1}catch(e){}return!0}},{DOM:"Utils.DOM",Arrays:"Utils.Arrays"}),_context.invoke("Nittro.Forms",function(DOM,Arrays,DateTime,FormData,Vendor,undefined){var Form=_context.extend("Nittro.Object",function(form){if(Form.Super.call(this),"string"==typeof form&&(form=DOM.getById(form)),!(form&&form instanceof HTMLFormElement))throw new TypeError("Invalid argument, must be a HTMLFormElement");this._.form=form,this._.form.noValidate="novalidate",this._.submittedBy=null,DOM.addListener(this._.form,"submit",this._handleSubmit.bind(this)),DOM.addListener(this._.form,"reset",this._handleReset.bind(this))},{getElement:function(name){return name?this._.form.elements.namedItem(name):this._.form},setSubmittedBy:function(value){return this._.submittedBy=value,this},validate:function(){if(!Vendor.validateForm(this._.form))return!1;var evt=this.trigger("validate");return!evt.isDefaultPrevented()},setValues:function(values,reset){var i,elem,name,value,names=[];for(values||(values={}),i=0;i<this._.form.elements.length;i++)if(elem=this._.form.elements.item(i),name=elem.name,value=undefined,!(!name||names.indexOf(name)>-1||"button"===elem.tagName.toLowerCase()||elem.type in{submit:1,reset:1,button:1,image:1})){if(names.push(name),name.indexOf("[")>-1?(value=values,name.replace(/]/g,"").split(/\[/g).some(function(key){return""===key?!0:key in value?(value=value[key],!1):(value=undefined,!0)})):name in values&&(value=values[name]),value===undefined){if(!reset||DOM.hasClass(elem,"no-reset"))continue;value=null}this.setValue(name,value)}},setValue:function(elem,value){"string"==typeof elem&&(elem=this._.form.elements.namedItem(elem));var i,toStr=function(v){return""+v};if(!elem)throw new TypeError("Invalid argument to setValue(), must be (the name of) an existing form element");if(elem.tagName)if("radio"===elem.type)elem.checked=null!==value&&elem.value===toStr(value);else if("file"===elem.type)null===value&&(value=elem.parentNode.innerHTML,DOM.html(elem.parentNode,value));else if("select"===elem.tagName.toLowerCase()){var v,single="select-one"===elem.type,arr=Arrays.isArray(value);for(value=arr?value.map(toStr):toStr(value),i=0;i<elem.options.length&&(v=arr?value.indexOf(elem.options.item(i).value)>-1:value===elem.options.item(i).value,elem.options.item(i).selected=v,!v||!single);i++);}else"checkbox"===elem.type?elem.checked=Arrays.isArray(value)?value.map(toStr).indexOf(elem.value)>-1:!!value:"date"===elem.type?elem.value=value?DateTime.from(value).format("Y-m-d"):"":"datetime-local"===elem.type||"datetime"===elem.type?elem.value=value?DateTime.from(value).format("Y-m-d\\TH:i:s"):"":elem.value=null!==value?toStr(value):"";else if("length"in elem)for(i=0;i<elem.length;i++)this.setValue(elem[i],value);return this},serialize:function(){var elem,i,value,data=new FormData,names=[];for(i=0;i<this._.form.elements.length;i++)elem=this._.form.elements.item(i),!elem.name||-1!==names.indexOf(elem.name)||("submit"!==elem.type||elem.name!==this._.submittedBy)&&elem.type in{button:1,reset:1}||names.push(elem.name);for(i=0;i<names.length;i++)if(elem=this._.form.elements.namedItem(names[i]),!Vendor.isDisabled(elem))if(value=Vendor.getEffectiveValue(elem),Arrays.isArray(value)||value instanceof FileList)for(var j=0;j<value.length;j++)data.append(names[i],value[j]);else data.append(names[i],value);return this.trigger("serialize",data),data},submit:function(by){var evt;if(by){var btn=this._.form.elements.namedItem(by);if(btn&&"submit"===btn.type)return evt=document.createEvent("MouseEvents"),evt.initMouseEvent("click",!0,!0,window),btn.dispatchEvent(evt),this;throw new TypeError("Unknown element or not a submit button: "+by)}return evt=document.createEvent("HTMLEvents"),evt.initEvent("submit",!0,!0),this._.form.dispatchEvent(evt),this},reset:function(){return this._.form.reset(),this},_handleSubmit:function(evt){return this.trigger("submit").isDefaultPrevented()?void evt.preventDefault():void(this.validate()||evt.preventDefault())},_handleReset:function(evt){if(evt.target===this._.form){var elem,i;for(i=0;i<this._.form.elements.length;i++)elem=this._.form.elements.item(i),DOM.hasClass(elem,"no-reset")||("select"===elem.tagName.toLowerCase()||"hidden"===elem.type?this.setValue(elem,DOM.getData(elem,"defaultValue")||""):"file"===elem.type&&this.setValue(elem,null));this.trigger("reset")}}});_context.register(Form,"Form")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays",DateTime:"Utils.DateTime",FormData:"Nittro.Ajax.FormData"}),_context.invoke("Nittro.Forms",function(Form,Vendor){var Locator=_context.extend(function(flashMessages){this._={flashMessages:flashMessages,registry:{},anonId:0},Vendor.addError=this._handleError.bind(this)},{getForm:function(id){var elem;return"string"!=typeof id&&(elem=id,elem.getAttribute("id")||elem.setAttribute("id","frm-anonymous"+ ++this._.anonId),id=elem.getAttribute("id")),id in this._.registry||(this._.registry[id]=new Form(elem||id),this._.registry[id].on("error:default",this._showError.bind(this))),this._.registry[id]},removeForm:function(id){"string"!=typeof id&&(id=id.getAttribute("id")),id in this._.registry&&delete this._.registry[id]},_handleError:function(elem,msg){var frm=this.getForm(elem.form);frm.trigger("error",{elem:elem,message:msg})},_showError:function(evt){this._.flashMessages.add(evt.data.elem,"warning",evt.data.message),evt.data.elem&&"function"==typeof evt.data.elem.focus&&evt.data.elem.focus()}});_context.register(Locator,"Locator")}),_context.invoke("Nittro.DI",function(Nittro,ReflectionClass,ReflectionFunction,Arrays,Strings,HashMap,Neon,NeonEntity,undefined){var prepare=function(self){self._||(self._={}),self._.services||(self._.services={},self._.serviceDefs={})},Container={addService:function(name,service){if(prepare(this),this._.services[name]||this._.serviceDefs[name])throw new Error('Container already has a service named "'+name+'"');return this._.services[name]=service,this},addServiceDefinition:function(name,definition){if(prepare(this),this._.services[name]||this._.serviceDefs[name])throw new Error('Container already has a service named "'+name+'"');return this._.serviceDefs[name]=definition,this},getService:function(name){if(prepare(this),"container"===name)return this;if(this._.services[name]===undefined){if(!this._.serviceDefs[name])throw new Error('Container has no service named "'+name+'"');this._createService(name)}return this._.services[name]},hasService:function(name){return prepare(this),"container"===name||this._.services[name]!==undefined||this._.serviceDefs[name]!==undefined},isServiceCreated:function(name){if(!this.hasService(name))throw new Error('Container has no service named "'+name+'"');return!!this._.services[name]},runServices:function(){prepare(this);var name,def;for(name in this._.serviceDefs)def=this._.serviceDefs[name],("string"==typeof def&&def.match(/!$/)||def.factory!==undefined&&def.run)&&this.getService(name)},invoke:function(callback,args,thisArg){return prepare(this),args=this._autowireArguments(callback,args),callback.apply(thisArg||null,this._expandArguments(args))},_createService:function(name){if(!this._.serviceDefs[name])throw new Error('Container has no service "'+name+'"');"string"==typeof this._.serviceDefs[name]&&(this._.serviceDefs[name]={run:!!this._.serviceDefs[name].match(/!$/),factory:this._.serviceDefs[name].replace(/!$/,"")});var factory,obj,service,def=this._.serviceDefs[name];if("function"==typeof def.factory){if(service=this.invoke(def.factory),!service)throw new Error('Factory failed to create service "'+name+'"')}else if(factory=this._toEntity(def.factory),service=this._expandEntity(factory),service===factory)throw new Error('Invalid factory for service "'+name+'"');if(this._.services[name]=service,def.setup!==undefined)for(var i=0;i<def.setup.length;i++)"function"==typeof def.setup[i]?this.invoke(def.setup[i],null,service):(obj=this._toEntity(def.setup[i]),this._expandEntity(obj,service));return service},_autowireArguments:function(callback){var i,a,argList=ReflectionFunction.from(callback).getArgs(),args=Arrays.createFrom(arguments,1).filter(function(arg){return!!arg}).map(function(arg){return arg instanceof HashMap?arg.isList()&&(arg=HashMap.from(arg.getValues(),argList)):arg=HashMap.from(arg,argList),arg});lookupArg:for(i=0;i<argList.length;i++){for(a=args.length-1;a>=0;a--){if(args[a].has(argList[i])){argList[i]=args[a].get(argList[i]);continue lookupArg}if(args[a].has(i)){argList[i]=args[a].get(i);continue lookupArg}}{if(!this.hasService(argList[i]))throw new Error('Cannot autowire argument "'+argList[i]+'" of function');argList[i]=this.getService(argList[i])}}return argList},_expandArguments:function(args){for(var i=0;i<args.length;i++)args[i]=this._expandArg(args[i]);return args},_expandArg:function(arg){return arg instanceof NeonEntity?this._expandEntity(arg):"string"==typeof arg&&arg.match(/^@\S+$/)?this.getService(arg.substr(1)):arg},_toEntity:function(str){var m=str.match(/^([^\(]+)\((.*)\)$/);return m?new NeonEntity(m[1],Neon.decode("["+m[2]+"]")):new NeonEntity(str,new HashMap)},_expandEntity:function(entity,context,mergeArgs){var m,obj,method,args;if(m=entity.value.match(/^(?:(@)?([^:].*?))?(?:::(.+))?$/)){if(m[2])obj=m[1]?this.getService(m[2]):ReflectionClass.getClass(m[2]);else{if(!context)throw new Error("No context for calling "+entity.value+" given");obj=context}if(m[3]!==undefined)return method=m[3],args=this._autowireArguments(obj[method],entity.attributes,mergeArgs),obj[method].apply(obj,this._expandArguments(args));if(m[1]){if(entity.attributes.length)throw new Error('Invalid entity "'+entity.value+'"');return obj}return args=this._autowireArguments(obj,entity.attributes,mergeArgs),ReflectionClass.from(obj).newInstanceArgs(this._expandArguments(args))}return entity}};_context.register(Container,"Container")},{ReflectionClass:"Utils.ReflectionClass",ReflectionFunction:"Utils.ReflectionFunction",Arrays:"Utils.Arrays",Strings:"Utils.Strings",HashMap:"Utils.HashMap",Neon:"Nittro.Neon.Neon",NeonEntity:"Nittro.Neon.NeonEntity"}),_context.invoke("Nittro.DI",function(Container,Arrays,HashMap,ReflectionClass,NeonEntity,undefined){function traverse(cursor,path,create){"string"==typeof path&&(path=path.split(/\./g));var i,p,n=path.length;for(i=0;n>i;i++){if(p=path[i],Arrays.isArray(cursor)&&p.match(/^\d+$/)&&(p=parseInt(p)),cursor[p]===undefined){if(!create)return undefined;cursor[p]={}}cursor=cursor[p]}return cursor}var Context=_context.extend(function(config){config||(config={}),this._={params:Arrays.mergeTree({},config.params||null),serviceDefs:Arrays.mergeTree({},config.services||null),services:{},factories:Arrays.mergeTree({},config.factories||null)}},{hasParam:function(name){return traverse(this._.params,name)!==undefined},getParam:function(name,def){var value=traverse(this._.params,name);return value!==undefined?value:def!==undefined?def:null},setParam:function(name,value){name=name.split(/\./g);var p=name.pop(),cursor=this._.params;return name.length&&(cursor=traverse(cursor,name,!0)),Arrays.isArray(cursor)&&p.match(/^\d+$/)&&(p=parseInt(p)),cursor[p]=value,this},hasFactory:function(name){return this._.factories[name]!==undefined},addFactory:function(name,factory,params){return"string"==typeof factory?this._.factories[name]=factory:this._.factories[name]={callback:factory,params:params||null},this},create:function(name,args){if(!this.hasFactory(name))throw new Error('No factory named "'+name+'" has been registered');var factory=this._.factories[name];return"string"==typeof factory?this._.factories[name]=factory=this._toEntity(factory):factory.params instanceof HashMap||(factory.params=new HashMap(factory.params)),factory instanceof NeonEntity?this._expandEntity(factory,null,args):(args=this._autowireArguments(factory.callback,factory.params,args),factory.callback.apply(null,this._expandArguments(args)))},_expandArg:function(arg){return"string"==typeof arg&&arg.indexOf("%")>-1?arg.match(/^%[^%]+%$/)?this.getParam(arg.replace(/^%|%$/g,"")):arg.replace(/%([a-z0-9_.-]+)%/i,function(){return this.getParam(arguments[1])}.bind(this)):this.__expandArg(arg)}});_context.mixin(Context,Container,{_expandArg:"__expandArg"}),_context.register(Context,"Context")},{Arrays:"Utils.Arrays",HashMap:"Utils.HashMap",ReflectionClass:"Utils.ReflectionClass",NeonEntity:"Nittro.Neon.NeonEntity"}),_context.invoke("Nittro.Application",function(){var Storage=_context.extend(function(namespace,persistent){this._.persistent=persistent,this._.engine=persistent?window.localStorage:window.sessionStorage,this._.items={},this._.namespace=namespace||"",this._.filters={"in":[],out:[]}},{STATIC:{NAMESPACE_SEPARATOR:"/",FILTER_IN:"in",FILTER_OUT:"out"},getItem:function(key,need){var value=this._.engine.getItem(this._formatKey(key));if(null===value){if(need)throw new Error;return null}return this._applyFilters(this._parseValue(value),Storage.FILTER_OUT)},setItem:function(key,value){return value=this._stringifyValue(this._applyFilters(value,Storage.FILTER_IN)),this._.engine.setItem(this._formatKey(key),value),this},hasItem:function(key){return null!==this._.engine.getItem(this._formatKey(key))},removeItem:function(key){return this._.engine.removeItem(this._formatKey(key)),this},clear:function(){for(var ns=this._.namespace+Storage.NAMESPACE_SEPARATOR,nsl=ns.length,rem=[],i=0;i<this._.engine.length;i++){var k=this._.engine.key(i);k.substr(0,nsl)===ns&&rem.push(k)}for(;rem.length;)this._.engine.removeItem(rem.shift());return this},walk:function(callback){for(var ns=this._.namespace+Storage.NAMESPACE_SEPARATOR,nsl=ns.length,i=0;i<this._.engine.length;i++){var k=this._.engine.key(i);if(k.substr(0,nsl)===ns){k=k.substr(nsl);var v=this.getItem(k);callback.call(v,k,v)}}},getNamespace:function(namespace){return new this.constructor((this._.namespace?this._.namespace+Storage.NAMESPACE_SEPARATOR:"")+namespace,this._.persistent)},addFilter:function(callback,type){return this._.filters[type].push(callback),this},_formatKey:function(key){return this._.namespace+Storage.NAMESPACE_SEPARATOR+key},_parseValue:function(value){return JSON.parse(value)},_stringifyValue:function(value){return JSON.stringify(value)},_applyFilters:function(value,type){for(var i=0;i<this._.filters[type].length;i++)value=this._.filters[type][i](value);return value}});_context.register(Storage,"Storage")}),_context.invoke("Nittro.Application.Routing",function(Nittro,Strings,Arrays){var URLRoute=_context.extend(Nittro.Object,function(mask){URLRoute.Super.call(this),this._.mask=this._prepareMask(mask)},{STATIC:{styles:{"int":parseInt,"float":parseFloat,bool:function(v){return!v.match(/^(?:0|false|)$/)}}},match:function(url){var params=this.tryMatch(url);params&&(Arrays.mergeTree(params,url.getParams()),this.trigger("match",params))},tryMatch:function(url){var match=this._.mask.pattern.exec(url.getPath().replace(/^\/|\/$/g,""));if(!match)return null;var i,n,p,v,params={};for(match.shift(),i=0,n=this._.mask.map.length;n>i;i++)p=this._.mask.map[i],v=decodeURIComponent(match[i]),p.style?params[p.name]=URLRoute.styles[p.style].call(null,v):params[p.name]=v;return params},_prepareMask:function(mask){var match,param,reTop=/^([<\[\]\(])|^([^<\[\]\(]+)/,reParam=/^([^ #>]+)(?: +([^ #>]+))?(?: +#([^ >]+))? *>/,reParen=/\((?!\?:)/g,reOptional=/^\?:/,map=[],pattern=["^"];for(mask=mask.replace(/^\/|\/$/g,"");mask.length;){if(match=reTop.exec(mask),!match)throw new Error("Invalid mask, error near "+mask.substr(0,10));if(mask=mask.substr(match[0].length),"<"===match[1]){if(param=reParam.exec(mask),!param)throw new Error("Invalid mask, error near "+mask.substr(0,10));if(mask=mask.substr(param[0].length),param[2]?param[2]=param[2].replace(reParen,"(?:"):param[2]="[^/]+",pattern.push("(",param[2],")"),param[3]&&!(param[3]in URLRoute.styles))throw new Error("Unknown parameter style: "+param[3]);map.push({name:param[1],style:param[3]||null})}else"["===match[1]?pattern.push("(?:"):"]"===match[1]?pattern.push(")?"):"("===match[1]?pattern.push(reOptional.test(mask)?"(":"(?:"):pattern.push(Strings.escapeRegex(match[2]))}return pattern.push("$"),{pattern:new RegExp(pattern.join("")),map:map}}});_context.register(URLRoute,"URLRoute")},{Strings:"Utils.Strings",Arrays:"Utils.Arrays"}),_context.invoke("Nittro.Application.Routing",function(Nittro,DOM){var DOMRoute=_context.extend(Nittro.Object,function(selector){DOMRoute.Super.call(this),this._.selector=this._prepareSelector(selector)},{match:function(){var matches;if("id"===this._.selector.type){var elem=DOM.getById(this._.selector.value);matches=elem?[elem]:[]}else matches=DOM.getByClassName(this._.selector.value);matches.length&&this.trigger("match",matches)},_prepareSelector:function(selector){if(selector.match(/^[^.#]|[\s>\[:+]/))throw new Error("Invalid selector");return{type:"#"===selector.charAt(0)?"id":"class",value:selector.substr(1)}}});_context.register(DOMRoute,"DOMRoute")},{DOM:"Utils.DOM"}),_context.invoke("Nittro.Application.Routing",function(Nittro,DOMRoute,URLRoute,Url){var Router=_context.extend(Nittro.Object,function(page){Router.Super.call(this),this._.page=page,this._.routes={dom:{},url:{}},this._.page.on("setup",this._matchAll.bind(this))},{getDOMRoute:function(selector){return selector in this._.routes.dom||(this._.routes.dom[selector]=new DOMRoute(selector)),this._.routes.dom[selector]},getURLRoute:function(mask){return mask in this._.routes.url||(this._.routes.url[mask]=new URLRoute(mask)),this._.routes.url[mask]},_matchAll:function(){var k,url=Url.fromCurrent();for(k in this._.routes.url)this._.routes.url[k].match(url);for(k in this._.routes.dom)this._.routes.dom[k].match()}});_context.register(Router,"Router")},{Url:"Utils.Url"}),_context.invoke(function(Nittro){var di=new Nittro.DI.Context({params:{page:{whitelistLinks:!1,whitelistForms:!1,defaultTransition:".transition-slide, .transition-fade"},flashes:{layer:document.body}},services:{ajax:{factory:"Nittro.Ajax.Service()",run:!0,setup:["::addTransport(Nittro.Ajax.Transport.Native())"]},page:{factory:"Nittro.Page.Service(options: %page%)",run:!0,setup:["::setFormLocator()"]},transitions:"Nittro.Page.Transitions(300)",formLocator:"Nittro.Forms.Locator()",flashMessages:"Nittro.Widgets.FlashMessages(%flashes%)"},factories:{formDialog:"Nittro.Widgets.FormDialog(@formLocator)"}});this.di=di,di.runServices()}),window._stack||(window._stack=[]),function(stack){function exec(f){if("function"==typeof f)_context.invoke(f);else if("object"==typeof f&&"undefined"!=typeof f.load){var q=_context.load.apply(_context,f.load);"function"==typeof f.then?q.then(f.then):f.then&&f.then instanceof Array&&q.then.apply(_context,f.then)}else _context.invoke.apply(_context,f)}for(;stack.length;)exec(stack.shift());stack.push=function(){for(var i=0;i<arguments.length;i++)exec(arguments[i])}}(window._stack);